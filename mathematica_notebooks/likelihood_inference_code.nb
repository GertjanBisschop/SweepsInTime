(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    197561,       4609]
NotebookOptionsPosition[    184088,       4371]
NotebookOutlinePosition[    184428,       4386]
CellTagsIndexPosition[    184385,       4383]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Import data functions", "Subsubsection",
 CellChangeTimes->{{3.810314590559495*^9, 
  3.810314596597335*^9}},ExpressionUUID->"a33df38d-9333-43b9-abf6-\
230373cf0d27"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CurateData", "[", 
   RowBox[{
   "dfName_", ",", " ", "n_", ",", " ", "kmax_", ",", " ", "numItt_", ",", 
    " ", "folded_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"raw", "=", 
       RowBox[{"Import", "[", "dfName", "]"}]}], ",", " ", "results", ",", 
      " ", "blockAss"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"blockAss", " ", "=", " ", 
      RowBox[{"KeySort", "[", 
       RowBox[{"GroupBy", "[", 
        RowBox[{"raw", ",", " ", "First"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"results", " ", "=", " ", 
      RowBox[{"Values", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MakebSFS", "[", 
          RowBox[{"#", ",", "kmax", ",", " ", 
           RowBox[{"n", "-", "1"}], ",", " ", "numItt"}], "]"}], "&"}], "/@", 
        "blockAss"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"folded", "\[Equal]", "True"}], ",", "\[IndentingNewLine]", 
       RowBox[{"results", "=", 
        RowBox[{"FoldDataAroundSweepCentre", "[", "results", "]"}]}], ",", 
       "\[IndentingNewLine]", "results"}], "]"}]}]}], " ", 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810275338452384*^9, 3.8102753477137117`*^9}, {
  3.810275391969637*^9, 3.8102754847372313`*^9}, {3.8102770076269617`*^9, 
  3.81027710320376*^9}, {3.81027714512394*^9, 3.810277198115748*^9}, {
  3.810277747450148*^9, 3.810277841728915*^9}, {3.810277884688808*^9, 
  3.810277903963668*^9}, {3.810278142144174*^9, 3.8102781444395123`*^9}, {
  3.810278231671844*^9, 3.810278231858115*^9}, {3.8102803714966803`*^9, 
  3.810280403687503*^9}, {3.81028052395158*^9, 3.810280535495059*^9}, {
  3.810281547907961*^9, 3.81028158587945*^9}, {3.810281676307433*^9, 
  3.8102816799217987`*^9}, {3.810289589513503*^9, 3.810289614005642*^9}, {
  3.810314098802093*^9, 3.810314099207616*^9}, {3.810361751074254*^9, 
  3.8103618536823473`*^9}, {3.810361941609727*^9, 3.8103619759060287`*^9}, {
  3.810362232050097*^9, 3.810362294576755*^9}, {3.813036799634225*^9, 
  3.813036799999794*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"81377c29-242e-46dd-8e87-a70ab8d91a7c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ImportData", "[", 
   RowBox[{"dfName_", ",", "n_", ",", "kmax_", ",", " ", "neutral_"}], "]"}], 
  ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"raw", "=", 
       RowBox[{
        RowBox[{"Import", "[", "dfName", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "2"}]}]}], "]"}], "]"}]}], ",", " ", "results"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"results", "=", 
      RowBox[{"MakeAllbSFS", "[", 
       RowBox[{"raw", ",", "kmax", ",", 
        RowBox[{"n", "-", "1"}], ",", "neutral"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"results", "=", 
      RowBox[{"FoldDataAroundSweepCentre", "[", "results", "]"}]}], ";", 
     "\[IndentingNewLine]", "results"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811001118607162*^9, 3.811001179781321*^9}, {
  3.811001212492569*^9, 3.811001222660941*^9}, {3.81100128345172*^9, 
  3.8110012884125853`*^9}, {3.811001330139901*^9, 3.811001383644912*^9}, {
  3.811002237670397*^9, 3.8110022390316973`*^9}, {3.811002580588478*^9, 
  3.811002580668622*^9}, {3.811002877491506*^9, 3.8110028844922247`*^9}, {
  3.8110038779185467`*^9, 3.811003943822658*^9}, {3.811050926509006*^9, 
  3.811050931322453*^9}, {3.811090900400943*^9, 3.811090906178653*^9}, {
  3.811091744915214*^9, 3.81109174629825*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"f08eb01c-ef12-47b9-b3d0-8c67d0c74659"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ImportDataCutOff", "[", 
   RowBox[{
   "dfName_", ",", "n_", ",", "kmax_", ",", " ", "neutral_", ",", " ", 
    "cutOff_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"raw", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", "dfName", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "2"}]}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", "cutOff"}], "]"}], "]"}]}], ",", " ", "results"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"results", "=", 
      RowBox[{"MakeAllbSFS", "[", 
       RowBox[{"raw", ",", "kmax", ",", 
        RowBox[{"n", "-", "1"}], ",", "neutral"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"results", "=", 
      RowBox[{"FoldDataAroundSweepCentre", "[", "results", "]"}]}], ";", 
     "\[IndentingNewLine]", "results"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811001118607162*^9, 3.811001179781321*^9}, {
  3.811001212492569*^9, 3.811001222660941*^9}, {3.81100128345172*^9, 
  3.8110012884125853`*^9}, {3.811001330139901*^9, 3.811001383644912*^9}, {
  3.811002237670397*^9, 3.8110022390316973`*^9}, {3.811002580588478*^9, 
  3.811002580668622*^9}, {3.811002877491506*^9, 3.8110028844922247`*^9}, {
  3.8110038779185467`*^9, 3.811003943822658*^9}, {3.811050926509006*^9, 
  3.811050931322453*^9}, {3.811090900400943*^9, 3.811090906178653*^9}, {
  3.811091744915214*^9, 3.81109174629825*^9}, {3.812823329071203*^9, 
  3.8128233387468147`*^9}, {3.812823490411312*^9, 3.8128235009606647`*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"cbf78fba-6639-41f5-908c-5d6354460427"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ImportDataCutOffComposite", "[", 
   RowBox[{
   "dfName_", ",", " ", "n_", ",", " ", "kmax_", ",", " ", "cutOff_"}], "]"}],
   ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"raw", "=", 
       RowBox[{"Import", "[", "dfName", "]"}]}], ",", " ", "results", ",", 
      " ", "blockAss"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"blockAss", " ", "=", " ", 
      RowBox[{
       RowBox[{"KeySort", "[", 
        RowBox[{"GroupBy", "[", 
         RowBox[{"raw", ",", " ", "First"}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{";;", "cutOff"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"results", " ", "=", " ", 
      RowBox[{"Values", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MakebSFS", "[", 
          RowBox[{"#", ",", "kmax", ",", " ", 
           RowBox[{"n", "-", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@", 
        "blockAss"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"results", "=", 
      RowBox[{"FoldDataAroundSweepCentre", "[", "results", "]"}]}], ";", 
     "\[IndentingNewLine]", "results"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.812561783378252*^9, 3.81256185959132*^9}, {
   3.812561962712315*^9, 3.812562004336657*^9}, {3.8125621838026876`*^9, 
   3.8125622070364523`*^9}, {3.812562245946607*^9, 3.812562250615961*^9}, {
   3.814188433649219*^9, 3.814188437702938*^9}, {3.814188487024005*^9, 
   3.8141885861911507`*^9}, 3.814188811437316*^9, {3.8141898962214813`*^9, 
   3.814189902618191*^9}, {3.814202501761842*^9, 3.814202528080036*^9}, {
   3.814204394648479*^9, 3.814204398566008*^9}, {3.81900500848223*^9, 
   3.819005033351506*^9}},ExpressionUUID->"937d61c2-396a-4f1a-9ed1-\
8f5bc76f5412"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakeAllbSFS", "[", 
   RowBox[{
   "bsfs_List", ",", " ", "kmax_", ",", " ", "mutypes_", ",", "neutral_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rules", ",", " ", "result"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rules", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Clip", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"kmax", "+", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
       "bsfs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rules", "=", 
      RowBox[{"AddOne", "/@", "rules"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rules", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", "\[Rule]", "1"}], "}"}], "&"}], "/@", "rules"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"SparseArray", "[", 
         RowBox[{"#", ",", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"kmax", "+", "2"}], ",", " ", "mutypes"}], "]"}], ",", 
          "0"}], "]"}], "&"}], "/@", "rules"}]}], ";", "\[IndentingNewLine]", 
     "result"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8110013937646627`*^9, 3.8110014625634727`*^9}, {
  3.811001504394788*^9, 3.811001513411076*^9}, {3.811001688010448*^9, 
  3.8110017527540293`*^9}, {3.8110022325028133`*^9, 3.811002341455121*^9}, {
  3.811002390693966*^9, 3.8110024016788807`*^9}, {3.811002439216555*^9, 
  3.811002460510415*^9}, {3.811002617381824*^9, 3.811002644429329*^9}, {
  3.811002678004581*^9, 3.8110026791734867`*^9}, {3.811003740438011*^9, 
  3.811003842886878*^9}, {3.811004228333892*^9, 3.811004235179893*^9}, {
  3.811057512303583*^9, 3.811057515669367*^9}, {3.811058082613414*^9, 
  3.811058087706397*^9}, {3.811090933128619*^9, 3.811090940934951*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"105bab04-803c-42d9-88d8-abc67a5ef6f6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakebSFS", "[", 
   RowBox[{
   "bsfs_List", ",", " ", "kmax_", ",", "itons_", ",", " ", "numItt_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rules", ",", " ", "result"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rules", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Clip", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "3"}]}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"kmax", "+", "1"}]}], "}"}]}], "]"}], "\[Rule]", 
         RowBox[{"IntegerPart", "[", 
          RowBox[{"numItt", "*", 
           RowBox[{"Last", "[", "#", "]"}]}], "]"}]}], "&"}], "/@", 
       "bsfs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rules", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{"rules", ",", " ", "Total"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rules", "=", 
      RowBox[{"KeyMap", "[", 
       RowBox[{"AddOne", ",", "rules"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"rules", "=", 
      RowBox[{"Normal", "[", "rules", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"rules", ",", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"kmax", "+", "2"}], ",", " ", "itons"}], "]"}], ",", "0"}], 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810276545191532*^9, 3.810276551277422*^9}, {
   3.810277088427582*^9, 3.810277099371018*^9}, {3.810278240743256*^9, 
   3.8102782553385477`*^9}, {3.810278334671083*^9, 3.810278536550036*^9}, {
   3.8102786057512197`*^9, 3.810278616766018*^9}, {3.8102786767337923`*^9, 
   3.810278721579157*^9}, {3.8102793638283997`*^9, 3.8102794148115997`*^9}, {
   3.8102794887388363`*^9, 3.810279587994339*^9}, {3.810279659586247*^9, 
   3.810279671354608*^9}, 3.8102798174113503`*^9, {3.810280207137823*^9, 
   3.810280336216241*^9}, {3.810281897453899*^9, 3.810281908706317*^9}, {
   3.810281954244446*^9, 3.810281955266798*^9}, {3.810282067883955*^9, 
   3.810282073201762*^9}, {3.810286504893558*^9, 3.8102865134066343`*^9}, {
   3.810286567530898*^9, 3.810286572226842*^9}, {3.810287204608287*^9, 
   3.810287218041009*^9}, {3.810287280762446*^9, 3.810287284463138*^9}, {
   3.81028746081026*^9, 3.8102875058476973`*^9}, {3.8102875823994837`*^9, 
   3.8102876847435427`*^9}, {3.8102878132691793`*^9, 3.810287824262396*^9}, {
   3.810287973080123*^9, 3.810288017765662*^9}, 3.8102884736985683`*^9, {
   3.810288598395289*^9, 3.810288599891341*^9}, {3.810288666885867*^9, 
   3.810288713139751*^9}, {3.810288879661212*^9, 3.810288909146302*^9}, {
   3.8102939516352997`*^9, 3.8102939589437943`*^9}, {3.8103611332949343`*^9, 
   3.810361140752626*^9}, {3.810361215683222*^9, 3.8103612423402977`*^9}, {
   3.810361333772079*^9, 3.8103613395476713`*^9}, {3.8103613999489317`*^9, 
   3.810361402497189*^9}, {3.810361708659384*^9, 3.810361743090641*^9}, {
   3.810361915667568*^9, 3.810361917713962*^9}, {3.810361979596291*^9, 
   3.810361993281515*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"38094386-f324-44c9-b107-a74f40e12e31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AddOne", "[", "v_", "]"}], ":=", 
  RowBox[{"v", "+", "1"}]}]], "Input",
 InitializationCell->True,
 InitializationGroup->True,
 CellLabel->"In[4]:=",ExpressionUUID->"e1a523fd-ef95-4872-82f0-e3a24d785420"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FoldDataAroundSweepCentre", "[", "dataAr_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"middle", ",", "left", ",", " ", "right", ",", " ", "folded"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"middle", "=", 
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"Length", "[", "dataAr", "]"}], "/", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"left", " ", "=", " ", 
      RowBox[{"Reverse", "[", 
       RowBox[{"dataAr", "[", 
        RowBox[{"[", 
         RowBox[{";;", "middle"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"right", "=", 
      RowBox[{"dataAr", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"middle", "+", "1"}], ";;"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"folded", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{"AddSparseArrays", ",", 
        RowBox[{"{", 
         RowBox[{"left", ",", " ", "right"}], "}"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810357783196864*^9, 3.8103578108953323`*^9}, {
  3.8103578621359377`*^9, 3.8103578742579727`*^9}, {3.810358008558361*^9, 
  3.810358082878276*^9}, {3.810358273694811*^9, 3.810358294485722*^9}, {
  3.810360443904717*^9, 3.810360450543076*^9}, {3.810361627524784*^9, 
  3.810361683330883*^9}, {3.8103618365149603`*^9, 3.81036184261053*^9}, {
  3.8103622409874887`*^9, 3.810362276024776*^9}, {3.810362459770412*^9, 
  3.810362460007659*^9}, {3.8130372254892263`*^9, 3.813037226150466*^9}, {
  3.813037286378194*^9, 3.813037290249112*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"959b1860-616a-4bc9-a101-0a1d3c8af064"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AddSparseArrays", "[", 
   RowBox[{"spA1_", ",", " ", "spA2_"}], "]"}], ":=", 
  RowBox[{"SparseArray", "[", 
   RowBox[{
    RowBox[{"Normal", "[", "spA1", "]"}], "+", 
    RowBox[{"Normal", "[", "spA2", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810362156636826*^9, 3.810362214312664*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"3a9a5e39-ffa6-4033-8988-02488f233115"]
}, Closed]],

Cell[CellGroupData[{

Cell["MakeProbTable", "Subsubsection",
 CellChangeTimes->{
  3.640843612060459*^9, 3.649128942665071*^9, {3.649226319023197*^9, 
   3.6492263301414413`*^9}},ExpressionUUID->"2cd2e925-1efd-426f-811a-\
48f401800045"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MakeProbTable", "::", "usage"}], "=", 
   "\"\<MakeProbTable[GF,\[Omega],\[Theta],branches,{\!\(\*SubscriptBox[\(k\),\
 \(m, 1\)]\),\[Ellipsis]}] generates a sparse array that gives the \
probability of each possible mutation type. MakeProbTable[{GF,\[Ellipsis]},\
\[Omega],\[Theta],branches,{\!\(\*SubscriptBox[\(k\), \(m, \
1\)]\),\[Ellipsis]}] generates a list of tables, all with the same \
dimensions. Generates a large sparse array, with dimensions \[Product](2+\!\(\
\*SubscriptBox[\(k\), \(max, i\)]\)), where \!\(\*SubscriptBox[\(k\), \
\(m\)]\) defines the maximum number of mtations that are counted.  The last \
entry in each column gives the residual probability - that is, the index runs \
{0,,1,\[Ellipsis],\!\(\*SubscriptBox[\(k\), \(max\)]\),residual}.  This is \
calculated using adjustTable.  The table is arranged in the same order as the \
list of branches that is supplied. Replacing {\!\(\*SubscriptBox[\(k\), \(m, \
1\)]\),\[Ellipsis]} by an integer, \!\(\*SubscriptBox[\(k\), \(m\)]\), sets \
the same maximum number of loci across all branches. OldMethod\[Rule]False] \
is a slower version that uses a series expansion rather than the default \
option of direct differentiation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640842946382422*^9, 3.640842979503961*^9}, {
   3.640843484211329*^9, 3.640843600239127*^9}, {3.640843653371766*^9, 
   3.6408436548024893`*^9}, {3.640843975619087*^9, 3.640843977851286*^9}, 
   3.640846440528327*^9, {3.640855695745816*^9, 3.640855803052887*^9}, {
   3.6408678181959476`*^9, 3.640867841777218*^9}, {3.649128946638563*^9, 
   3.649128950457561*^9}, {3.649167512520542*^9, 3.6491675453024273`*^9}, {
   3.649167965229828*^9, 3.649168018551893*^9}, {3.6492176612988157`*^9, 
   3.649217671387586*^9}, {3.649217717663602*^9, 3.649217723374856*^9}, 
   3.64921788787681*^9, {3.649218526802175*^9, 3.649218554352854*^9}, {
   3.6493122600378313`*^9, 3.649312417789061*^9}, {3.6493378545483313`*^9, 
   3.64933788714596*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"e1a3be73-336e-4229-adae-3e13c2f55ac0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OldMethod", "::", "usage"}], "=", 
    "\"\<OldMethod is an option for MakeProbTable; OldMethod\[Rule]False \
specifies that a series expansion, raher than direct differentiation using \
probK should be used (the default).\>\""}], ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640843613640566*^9, 3.6408440045539017`*^9}, {
   3.640844184080473*^9, 3.6408444361997843`*^9}, {3.6408463756741533`*^9, 
   3.640846375842431*^9}, {3.640846417109716*^9, 3.64084641746902*^9}, 
   3.640846453150058*^9, {3.640856030726782*^9, 3.640856030910614*^9}, {
   3.640856195178887*^9, 3.640856258906266*^9}, {3.6408587176821337`*^9, 
   3.6408587179116993`*^9}, {3.640858775825757*^9, 3.6408588599546347`*^9}, {
   3.640858927425767*^9, 3.6408589337258043`*^9}, {3.640859490904359*^9, 
   3.640859499949051*^9}, {3.6408598118159647`*^9, 3.640859835277295*^9}, 
   3.640859936546945*^9, {3.6408600437577972`*^9, 3.6408600440769873`*^9}, {
   3.646987144262879*^9, 3.646987172381156*^9}, 3.649128948864154*^9, {
   3.6491468923576727`*^9, 3.6491469292640657`*^9}, {3.649149284780066*^9, 
   3.649149285476029*^9}, {3.64916794086471*^9, 3.6491679785814667`*^9}, {
   3.6492176124787493`*^9, 3.6492177283774433`*^9}, {3.64921892258916*^9, 
   3.649218980473569*^9}, {3.649225454712614*^9, 3.649225494078476*^9}, 
   3.6493123381168337`*^9},
 CellLabel->"In[8]:=",ExpressionUUID->"3fd339ab-3107-442a-85ae-bf336b45cc6c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MakeProbTable", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"OldMethod", "\[Rule]", "True"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640843613640566*^9, 3.6408440045539017`*^9}, {
   3.640844184080473*^9, 3.6408444361997843`*^9}, {3.6408463756741533`*^9, 
   3.640846375842431*^9}, {3.640846417109716*^9, 3.64084641746902*^9}, 
   3.640846453150058*^9, {3.640856030726782*^9, 3.640856030910614*^9}, {
   3.640856195178887*^9, 3.640856258906266*^9}, {3.6408587176821337`*^9, 
   3.6408587179116993`*^9}, {3.640858775825757*^9, 3.6408588599546347`*^9}, {
   3.640858927425767*^9, 3.6408589337258043`*^9}, {3.640859490904359*^9, 
   3.640859499949051*^9}, {3.6408598118159647`*^9, 3.640859835277295*^9}, 
   3.640859936546945*^9, {3.6408600437577972`*^9, 3.6408600440769873`*^9}, {
   3.646987144262879*^9, 3.646987172381156*^9}, 3.649128948864154*^9, {
   3.6491468923576727`*^9, 3.6491469292640657`*^9}, {3.649149284780066*^9, 
   3.649149285476029*^9}, {3.64916794086471*^9, 3.6491679785814667`*^9}, {
   3.6492176124787493`*^9, 3.6492177283774433`*^9}, {3.649225478306301*^9, 
   3.649225478813648*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"62d20b6c-a3a2-4b24-b62c-0faf438c0552"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MakeProbTable", "::", "badList"}], "=", 
   "\"\<The list `1` of maximum numbers of mutations must have length equal \
to the list of branches, `2`.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640843613640566*^9, 3.6408440045539017`*^9}, {
   3.640844184080473*^9, 3.6408444361997843`*^9}, {3.6408463756741533`*^9, 
   3.640846375842431*^9}, {3.640846417109716*^9, 3.64084641746902*^9}, 
   3.640846453150058*^9, {3.640856030726782*^9, 3.640856030910614*^9}, {
   3.640856195178887*^9, 3.640856258906266*^9}, {3.6408587176821337`*^9, 
   3.6408587179116993`*^9}, {3.640858775825757*^9, 3.6408588599546347`*^9}, {
   3.640858927425767*^9, 3.6408589337258043`*^9}, {3.640859490904359*^9, 
   3.640859499949051*^9}, {3.6408598118159647`*^9, 3.640859835277295*^9}, 
   3.640859936546945*^9, {3.6408600437577972`*^9, 3.6408600440769873`*^9}, {
   3.646987144262879*^9, 3.646987172381156*^9}, 3.649128948864154*^9, {
   3.6491468923576727`*^9, 3.6491469292640657`*^9}, {3.649149284780066*^9, 
   3.649149285476029*^9}, {3.64916794086471*^9, 3.6491679785814667`*^9}, {
   3.6492176124787493`*^9, 3.6492177283774433`*^9}, {3.649218573728085*^9, 
   3.649218660232098*^9}, {3.6493124941855497`*^9, 3.649312503892152*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"675ea000-5b7d-4137-a160-12b7149d09e4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MakeProbTable", "::", "badBranches"}], "=", 
   "\"\<The branches represented in the GF, `1` are not a subset of the \
supplied list of brancheslist of branches, `2`.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640843613640566*^9, 3.6408440045539017`*^9}, {
   3.640844184080473*^9, 3.6408444361997843`*^9}, {3.6408463756741533`*^9, 
   3.640846375842431*^9}, {3.640846417109716*^9, 3.64084641746902*^9}, 
   3.640846453150058*^9, {3.640856030726782*^9, 3.640856030910614*^9}, {
   3.640856195178887*^9, 3.640856258906266*^9}, {3.6408587176821337`*^9, 
   3.6408587179116993`*^9}, {3.640858775825757*^9, 3.6408588599546347`*^9}, {
   3.640858927425767*^9, 3.6408589337258043`*^9}, {3.640859490904359*^9, 
   3.640859499949051*^9}, {3.6408598118159647`*^9, 3.640859835277295*^9}, 
   3.640859936546945*^9, {3.6408600437577972`*^9, 3.6408600440769873`*^9}, {
   3.646987144262879*^9, 3.646987172381156*^9}, 3.649128948864154*^9, {
   3.6491468923576727`*^9, 3.6491469292640657`*^9}, {3.649149284780066*^9, 
   3.649149285476029*^9}, {3.64916794086471*^9, 3.6491679785814667`*^9}, {
   3.6492176124787493`*^9, 3.6492177283774433`*^9}, {3.649218573728085*^9, 
   3.649218660232098*^9}, {3.6493124941855497`*^9, 3.649312503892152*^9}, {
   3.649312596688553*^9, 3.649312597780368*^9}, {3.649312663992964*^9, 
   3.649312684140029*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"3f5354ff-9eb7-4fdf-b96e-ebdbf422ccbb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MakeProbTable", "[", 
    RowBox[{
    "gf_", ",", "\[Omega]_", ",", "\[Theta]_", ",", "branches_List", ",", 
     "km_Integer", ",", "opts___Rule"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"MakeProbTable", "[", 
    RowBox[{"gf", ",", "\[Omega]", ",", "\[Theta]", ",", "branches", ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"km", ",", 
       RowBox[{"Length", "[", "branches", "]"}]}], "]"}], ",", "opts"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MakeProbTable", "[", 
    RowBox[{
    "gf_", ",", "\[Omega]_", ",", "\[Theta]_", ",", "branches_List", ",", 
     RowBox[{"km", ":", 
      RowBox[{"{", "__Integer", "}"}]}], ",", "opts___Rule"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ListQ", "[", "gf", "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"MakeProbTable", "[", 
        RowBox[{
        "#", ",", "\[Omega]", ",", "\[Theta]", ",", "branches", ",", "km", 
         ",", "opts"}], "]"}], "&"}], "/@", "gf"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"configs", "=", 
          RowBox[{"GetConfigsGF", "[", 
           RowBox[{"gf", ",", "\[Omega]"}], "]"}]}], ",", "posn", ",", "nc", 
         ",", "tt"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "km", "]"}], "\[NotEqual]", 
           RowBox[{"Length", "[", "branches", "]"}]}], ",", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"MakeProbTable", "::", "badList"}], ",", "km", ",", 
            "branches"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"SubsetQ", "[", 
            RowBox[{"branches", ",", "configs"}], "]"}]}], ",", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"MakeProbTable", "::", "badBranches"}], ",", "configs", 
            ",", "branches"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"posn", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"branches", ",", "#"}], "]"}], "&"}], "/@", "configs"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tt", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"OldMethod", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{"Options", "[", "MakeProbTable", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nc", "=", 
             RowBox[{"Length", "[", "configs", "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "number", " ", "of", " ", "configurations", " ", "that", " ", 
              "appear", " ", "in", " ", "this", " ", "GF"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"adjustTable", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Array", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"probK", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#2", "\[Equal]", 
                    RowBox[{"#3", "+", "1"}]}], ",", "Null", ",", 
                    RowBox[{"{", 
                    RowBox[{"#1", ",", "#2"}], "}"}]}], "]"}], "&"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{"configs", ",", 
                    RowBox[{"{", "##", "}"}], ",", 
                    RowBox[{
                    "km", "\[LeftDoubleBracket]", "posn", 
                    "\[RightDoubleBracket]"}]}], "}"}]}], "]"}], ",", 
                    "Null"}], "]"}], ",", "gf", ",", "\[Omega]", ",", 
                   "\[Theta]"}], "]"}], "&"}], ",", 
                RowBox[{
                 RowBox[{
                 "km", "\[LeftDoubleBracket]", "posn", 
                  "\[RightDoubleBracket]"}], "+", "2"}], ",", "0"}], "]"}], 
              ",", "nc"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Fold", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MakeProbTableOnce", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"\[Omega]", "[", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "]"}], ",", "\[Theta]", ",", 
                RowBox[{
                "#2", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], "]"}], "&"}], ",", "gf", ",", 
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{"configs", ",", 
                RowBox[{
                "km", "\[LeftDoubleBracket]", "posn", 
                 "\[RightDoubleBracket]"}]}], "}"}], "]"}]}], "]"}]}], 
          "]"}]}], ";", 
        RowBox[{"EmbedTable", "[", 
         RowBox[{"tt", ",", "posn", ",", "1", ",", 
          RowBox[{"km", "+", "2"}]}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640843613640566*^9, 3.6408440045539017`*^9}, {
   3.640844184080473*^9, 3.6408444361997843`*^9}, {3.6408463756741533`*^9, 
   3.640846375842431*^9}, {3.640846417109716*^9, 3.64084641746902*^9}, 
   3.640846453150058*^9, {3.640856030726782*^9, 3.640856030910614*^9}, {
   3.640856195178887*^9, 3.640856258906266*^9}, {3.6408587176821337`*^9, 
   3.6408587179116993`*^9}, {3.640858775825757*^9, 3.6408588599546347`*^9}, {
   3.640858927425767*^9, 3.6408589337258043`*^9}, {3.640859490904359*^9, 
   3.640859499949051*^9}, {3.6408598118159647`*^9, 3.640859835277295*^9}, 
   3.640859936546945*^9, {3.6408600437577972`*^9, 3.6408600440769873`*^9}, {
   3.646987144262879*^9, 3.646987172381156*^9}, 3.649128948864154*^9, {
   3.6491468923576727`*^9, 3.6491469292640657`*^9}, {3.649149284780066*^9, 
   3.649149285476029*^9}, {3.64916794086471*^9, 3.6491679785814667`*^9}, {
   3.6492176124787493`*^9, 3.649217678577755*^9}, {3.649217739629674*^9, 
   3.649217805642517*^9}, {3.649217896010532*^9, 3.6492178989198*^9}, {
   3.649218440708651*^9, 3.649218500908229*^9}, {3.649218665769054*^9, 
   3.649218702325425*^9}, {3.64921873852604*^9, 3.6492187640430813`*^9}, {
   3.649218854614504*^9, 3.6492189030389223`*^9}, {3.649219012872717*^9, 
   3.649219013446093*^9}, {3.649219204846094*^9, 3.649219222812841*^9}, {
   3.649219297194681*^9, 3.649219297523354*^9}, 3.6492196456874313`*^9, {
   3.649220163095214*^9, 3.649220176465498*^9}, 3.649220213567402*^9, {
   3.649220973217045*^9, 3.649220976632799*^9}, {3.649221185733904*^9, 
   3.649221189334671*^9}, {3.649221232430057*^9, 3.649221246188863*^9}, {
   3.649221500631833*^9, 3.649221504208709*^9}, {3.649221679825261*^9, 
   3.649221685275629*^9}, {3.649221756994583*^9, 3.649221759247026*^9}, {
   3.6492218290537977`*^9, 3.649221834134694*^9}, {3.649221901883892*^9, 
   3.649221903659176*^9}, {3.649221950446435*^9, 3.649221958028754*^9}, {
   3.649221997746375*^9, 3.649222000675515*^9}, {3.649222573624805*^9, 
   3.6492225745446463`*^9}, {3.649224702508026*^9, 3.6492247054152393`*^9}, {
   3.649225101572669*^9, 3.64922510529937*^9}, {3.6492979200154543`*^9, 
   3.649297944360058*^9}, 3.649299483066648*^9, {3.6493124254441032`*^9, 
   3.649312483264617*^9}, {3.649312514814398*^9, 3.649312518573333*^9}, {
   3.649312585040079*^9, 3.6493126574163113`*^9}, {3.649337950788828*^9, 
   3.649337998577237*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"d7df8e7b-8083-4568-a9f7-d0aa3bd4f51e"]
}, Closed]],

Cell[CellGroupData[{

Cell["GetConfigsGF", "Subsubsection",
 CellChangeTimes->{{3.8102960258336563`*^9, 
  3.8102960410909843`*^9}},ExpressionUUID->"51375c3c-c2eb-425e-982b-\
3e3b42acac90"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetConfigsGF", "::", "usage"}], "=", 
   "\"\<GetConfigsGF[GF,\[Omega]] finds all the sets of genes that appear in \
terms of the form \[Omega][{a,b}]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640790732481947*^9, 3.640790818265112*^9}, {
  3.640846316267313*^9, 3.640846346461569*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"8421e71c-0109-4023-af4c-e53065c1b419"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetConfigsGF", "[", 
    RowBox[{"expr_", ",", "\[Omega]_"}], "]"}], ":=", 
   RowBox[{"Union", "[", 
    RowBox[{"First", "/@", 
     RowBox[{"Cases", "[", 
      RowBox[{"expr", ",", 
       RowBox[{"\[Omega]", "[", "_List", "]"}], ",", "All"}], "]"}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640790829148787*^9, 3.640790848531934*^9}, {
  3.640846319231914*^9, 3.640846357989459*^9}, {3.640854194714225*^9, 
  3.640854199923027*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"1d9bae5b-05ee-4906-82c2-31058046c09e"]
}, Closed]],

Cell[CellGroupData[{

Cell["adjustTable", "Subsubsection",
 CellChangeTimes->{3.640591636424046*^9, 3.649129188878124*^9, 
  3.649228879287122*^9},ExpressionUUID->"be6af445-362c-441f-bb99-\
ca44a1697b44"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"adjustTable", "::", "usage"}], "=", 
   "\"\<adjustTable[{{\[Ellipsis]},\[Ellipsis]},d] takes a table with \
dimension d in which the last element at each level is the total probability, \
and produces a table in which the last element is the residual probability.  \
This new table should sum to 1. adjustTable[{{\[Ellipsis]},\[Ellipsis]},d,k] \
makes the adjustment only for level k.  Note that d cannot be inferred from \
the depth of the table, because its elements may themselves have depth. Works \
with sparse arrays.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640580522519785*^9, 3.640580636164969*^9}, {
  3.640600933555353*^9, 3.640600956578511*^9}, {3.640601005871625*^9, 
  3.6406010632102537`*^9}, {3.6408446271210737`*^9, 3.64084463587129*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"3c11841a-6723-4fae-9b17-cf1dd4bb0771"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"adjustTable", "[", 
    RowBox[{
     RowBox[{"t", ":", 
      RowBox[{"(", 
       RowBox[{"_List", "|", "_SparseArray"}], ")"}]}], ",", "d_Integer", ",",
      "k_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"jj", ",", "nt"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"jj", "=", 
       RowBox[{"RotateRight", "[", 
        RowBox[{
         RowBox[{"Range", "[", "d", "]"}], ",", 
         RowBox[{"k", "-", "1"}]}], "]"}]}], ";", 
      RowBox[{"nt", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"t", ",", "jj"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"ReplacePart", "[", 
         RowBox[{"nt", ",", 
          RowBox[{
           RowBox[{"-", "1"}], "\[Rule]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"nt", "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "-", 
             RowBox[{"Total", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"nt", ",", 
                RowBox[{"-", "1"}]}], "]"}], "]"}]}], ")"}]}]}], "]"}], ",", 
        RowBox[{"Normal", "[", 
         RowBox[{"SparseArray", "[", 
          RowBox[{"jj", "\[Rule]", 
           RowBox[{"Range", "[", "d", "]"}]}], "]"}], "]"}]}], "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640591373045816*^9, 3.640591508902577*^9}, {
   3.640601065530204*^9, 3.640601079210877*^9}, {3.640844673858938*^9, 
   3.640844694198039*^9}, {3.6408447322779093`*^9, 3.640844736886002*^9}, {
   3.64085486772892*^9, 3.640854868292383*^9}, 3.6465534880026293`*^9, 
   3.649129172746222*^9},
 CellLabel->"In[17]:=",ExpressionUUID->"eaefa8e7-1597-4255-8961-e04c62426715"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"adjustTable", "[", 
    RowBox[{
     RowBox[{"t", ":", 
      RowBox[{"(", 
       RowBox[{"_List", "|", "_SparseArray"}], ")"}]}], ",", "d_Integer"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"nt", "=", "t"}], ",", "j"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"nt", "=", 
         RowBox[{"adjustTable", "[", 
          RowBox[{"nt", ",", "d", ",", "j"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "d"}], "}"}]}], "]"}], ";", "nt"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640591373045816*^9, 3.640591543867977*^9}, {
   3.6405915740114727`*^9, 3.6405916530074472`*^9}, {3.640601201898571*^9, 
   3.640601209484951*^9}, {3.640601443201552*^9, 3.6406014433045387`*^9}, 
   3.640844687838696*^9, {3.640854871622017*^9, 3.640854872077547*^9}, {
   3.649129134627037*^9, 3.649129144984955*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"fd936f77-fd81-44b7-bbc3-07bf5db13f5c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"adjustTable", "[", 
    RowBox[{
     RowBox[{"t", ":", 
      RowBox[{"(", 
       RowBox[{"_List", "|", "_SparseArray"}], ")"}]}], ",", "d_Integer", ",",
      "k_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"jj", ",", "nt"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"jj", "=", 
       RowBox[{"RotateRight", "[", 
        RowBox[{
         RowBox[{"Range", "[", "d", "]"}], ",", 
         RowBox[{"k", "-", "1"}]}], "]"}]}], ";", 
      RowBox[{"nt", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"t", ",", "jj"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"ReplacePart", "[", 
         RowBox[{"nt", ",", 
          RowBox[{
           RowBox[{"-", "1"}], "\[Rule]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"nt", "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "-", 
             RowBox[{"Total", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"nt", ",", 
                RowBox[{"-", "1"}]}], "]"}], "]"}]}], ")"}]}]}], "]"}], ",", 
        RowBox[{"Normal", "[", 
         RowBox[{"SparseArray", "[", 
          RowBox[{"jj", "\[Rule]", 
           RowBox[{"Range", "[", "d", "]"}]}], "]"}], "]"}]}], "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640591373045816*^9, 3.640591508902577*^9}, {
   3.640601065530204*^9, 3.640601079210877*^9}, {3.640844673858938*^9, 
   3.640844694198039*^9}, {3.6408447322779093`*^9, 3.640844736886002*^9}, {
   3.64085486772892*^9, 3.640854868292383*^9}, 3.6465534880026293`*^9, 
   3.649129172746222*^9},
 CellLabel->"In[19]:=",ExpressionUUID->"15bd1f97-6319-47a2-a2e1-1eb30cf61e88"]
}, Closed]],

Cell[CellGroupData[{

Cell["probK", "Subsubsection",
 CellChangeTimes->{{3.640575853609971*^9, 3.640575854841469*^9}, 
   3.649128915669261*^9, 
   3.6492263353876133`*^9},ExpressionUUID->"3e2b861c-c0d2-43a0-a574-\
dca2cd7083b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"probK", "::", "usage"}], "=", 
   "\"\<probK[{{{a},2},{{{b,c},3},\[Ellipsis]},\[Psi],\[Omega],\[Theta]] \
gives the probability of 2 mutations ancestral to {a}, and 3 to {b,c}. If \
arguments are omitted, then the probability is summed over these classes.  If \
a table of all the probabilities is needed, it is more efficient to use \
MakeProbTable[].\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640575857554448*^9, 3.640575972609573*^9}, {
  3.640576701768317*^9, 3.640576757570215*^9}, {3.64057726704331*^9, 
  3.640577275143036*^9}, {3.640577498156272*^9, 3.640577518073368*^9}, {
  3.640578105150457*^9, 3.640578118606937*^9}, {3.648517944620528*^9, 
  3.6485179741139107`*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"0a19520e-826a-40d8-a497-731ac09af72c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"probK", "[", 
    RowBox[{
     RowBox[{"skl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_List", ",", "_Integer"}], "}"}], "..."}], "}"}]}], ",", 
     "\[Psi]_", ",", "\[Omega]_", ",", "\[Theta]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kl", ",", "rls"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rls", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[Omega]", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "\[Rule]", 
           RowBox[{"\[Theta]", "/", "2"}]}], ")"}], "&"}], "/@", "skl"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"kl", "=", 
       RowBox[{"Last", "/@", "skl"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       FractionBox[
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "\[Theta]"}], "/", "2"}], ")"}], 
         RowBox[{"Total", "[", "kl", "]"}]], 
        RowBox[{"Times", "@@", 
         RowBox[{"(", 
          RowBox[{"kl", "!"}], ")"}]}]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"\[Psi]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"(", 
              RowBox[{"skl", "/.", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"s_List", ",", "k_Integer"}], "}"}], ":>", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"\[Omega]", "[", "s", "]"}], ",", "k"}], "}"}]}]}], 
              ")"}]}]}], "]"}], "/.", "rls"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Omega]", "[", "_", "]"}], "\[RuleDelayed]", "0"}], 
          "}"}]}], ")"}]}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.640574976988158*^9, 3.640575050272925*^9}, {
   3.6405757659529667`*^9, 3.64057580046292*^9}, {3.6405759845318832`*^9, 
   3.640576039309659*^9}, {3.640576178681705*^9, 3.640576194799762*^9}, {
   3.6405767690776176`*^9, 3.640576814437688*^9}, {3.640576864147874*^9, 
   3.64057693274968*^9}, {3.64057697945673*^9, 3.6405770057224817`*^9}, {
   3.640577059374259*^9, 3.640577060005611*^9}, 3.640577456911639*^9, {
   3.640578124936125*^9, 3.6405782642354317`*^9}, {3.6407960648829737`*^9, 
   3.64079607964119*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"f8786dc2-bd2a-4895-9d16-1424804af910"],

Cell[TextData[{
 StyleBox["Note: ",
  FontWeight->"Bold"],
 "probK calculates the probability of a configuration ",
 Cell[BoxData[
  FormBox[
   StyleBox["k",
    FontVariations->{"Underline"->True}], TraditionalForm]],ExpressionUUID->
  "a0a89cf4-ae54-4ba6-b29e-e04d44f8d48c"],
 " by differentiating ",
 Cell[BoxData[
  FormBox[
   StyleBox["k",
    FontVariations->{"Underline"->True}], TraditionalForm]],ExpressionUUID->
  "4a73a980-447d-4d34-ac1c-4a31954a247f"],
 " times. If a full table of probabilities is needed, then it might be more \
efficient to use ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\[CloseCurlyQuote]s built-in series expansion, and extract the \
coefficients.  However, this is not straightforward."
}], "Text",
 CellChangeTimes->{{3.6485185790391273`*^9, 3.6485186898045273`*^9}, {
  3.649242484013975*^9, 3.6492425143004704`*^9}, {3.650630814311474*^9, 
  3.650630816998567*^9}},ExpressionUUID->"51db1938-38e7-43be-9f41-\
9800e53b57ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["EmbedTable", "Subsubsection",
 CellChangeTimes->{{3.649212375686616*^9, 3.6492123828197927`*^9}, {
  3.649299496831627*^9, 
  3.649299499336636*^9}},ExpressionUUID->"18fd7074-663b-4b53-8ab0-\
797bcc440cab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EmbedTable", "::", "usage"}], "=", 
   "\"\<EmbedTable[{{\[Ellipsis]},\[Ellipsis]},{\!\(\*SubscriptBox[\(i\), \(1\
\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(j\), \
\(1\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(d\), \(1\)]\),\[Ellipsis]}] \
embeds the given table in a larger SparseArray with dimensions \
{\!\(\*SubscriptBox[\(d\), \(1\)]\),\[Ellipsis]}. {\!\(\*SubscriptBox[\(i\), \
\(1\)]\),\[Ellipsis]} lists the positions of the table dimensions in the \
larger SparseArray, and {\!\(\*SubscriptBox[\(j\), \(1\)]\),\[Ellipsis]} \
lists the positions of the remaining dimensions.  For convenience, j has the \
same length as d, but the dimensions replaced by the embedded table are \
disregarded. \
EmbedTable[{{\[Ellipsis]},\[Ellipsis]},{\!\(\*SubscriptBox[\(i\), \(1\)]\),\
\[Ellipsis]},1,{\!\(\*SubscriptBox[\(d\), \(1\)]\),\[Ellipsis]}] uses the \
default position 1 for all dimensions.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6492123867628527`*^9, 3.649212409727695*^9}, {
  3.649212477061368*^9, 3.6492125911224947`*^9}, {3.64921267814808*^9, 
  3.649212683715139*^9}, {3.6492127912423153`*^9, 3.6492128441767*^9}, {
  3.6492154884641647`*^9, 3.649215543613553*^9}, {3.649295368263571*^9, 
  3.6492954340982113`*^9}, {3.649295666028533*^9, 3.649295898093977*^9}, {
  3.649295965720372*^9, 3.649295969159875*^9}, {3.6492995121160593`*^9, 
  3.6492995283662252`*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"5c1e4655-731c-4274-9157-c56bde48386c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"EmbedTable", "[", 
    RowBox[{"tbl_List", ",", 
     RowBox[{"i", ":", 
      RowBox[{"{", "___Integer", "}"}]}], ",", "j_Integer", ",", 
     RowBox[{"d", ":", 
      RowBox[{"{", "__Integer", "}"}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"EmbedTable", "[", 
    RowBox[{"tbl", ",", "i", ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"j", ",", 
       RowBox[{"Length", "[", "d", "]"}]}], "]"}], ",", "d"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EmbedTable", "[", 
    RowBox[{"tbl_List", ",", 
     RowBox[{"i", ":", 
      RowBox[{"{", "___Integer", "}"}]}], ",", 
     RowBox[{"j", ":", 
      RowBox[{"{", "___Integer", "}"}]}], ",", 
     RowBox[{"d", ":", 
      RowBox[{"{", "__Integer", "}"}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"xx", ",", "pl"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xx", "=", 
       RowBox[{"IntegerSets", "[", 
        RowBox[{"Dimensions", "[", "tbl", "]"}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "all", " ", "the", " ", "entries", " ", "that", " ", "will", " ", 
         "be", " ", "tabulated"}], ";", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "\[Ellipsis]"}], "}"}], "\[Ellipsis]", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["d", "1"], ",", 
           SubscriptBox["d", "2"], ",", "\[Ellipsis]"}], "}"}]}]}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"pl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{"j", ",", 
            RowBox[{"MapThread", "[", 
             RowBox[{"Rule", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "#"}], "}"}]}], "]"}]}], "]"}], ")"}], "&"}],
         "/@", "xx"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "lists", " ", "all", " ", "the", " ", "assignments", " ", "that", " ", 
        "will", " ", "be", " ", "used", " ", "to", " ", "build", " ", "the", 
        " ", "array"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"pl", "\[Rule]", 
         RowBox[{"Flatten", "[", "tbl", "]"}]}], ",", "d"}], "]"}]}]}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "builds", " ", "a", " ", "SparseArray", " ", "with", " ", "higher", " ", 
      "dimension", " ", "d", " ", "than", " ", "the", " ", "original", " ", 
      "table"}], " ", "*)"}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.649212392568575*^9, 3.64921239257065*^9}, {
   3.649212638590116*^9, 3.649212771294773*^9}, {3.6492128475608673`*^9, 
   3.649212926442412*^9}, {3.649212967039535*^9, 3.649212982759201*^9}, {
   3.649215762383939*^9, 3.6492157874992027`*^9}, {3.6492158532715893`*^9, 
   3.649215895730167*^9}, {3.649221458513599*^9, 3.649221458807961*^9}, {
   3.649247254364833*^9, 3.649247280230542*^9}, 3.6492474523425703`*^9, {
   3.649247526609167*^9, 3.649247556941296*^9}, {3.649295899388235*^9, 
   3.649295952507518*^9}, {3.649296337029293*^9, 3.649296379163351*^9}, 
   3.649296409234223*^9, 3.6492965072951717`*^9, {3.649296611994483*^9, 
   3.6492966158175993`*^9}, {3.649296937501575*^9, 3.649296963780735*^9}, {
   3.6492971486301823`*^9, 3.649297169072904*^9}, {3.6492972225806837`*^9, 
   3.649297227978567*^9}, {3.6492975455528593`*^9, 3.6492975483476677`*^9}, {
   3.649297677869442*^9, 3.649297683630636*^9}, {3.649299545505512*^9, 
   3.6492995825627613`*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"1a420612-5cf4-4126-872e-7d9caf1ba513"],

Cell[TextData[{
 StyleBox["Example: ",
  FontWeight->"Bold"],
 "The 2\[Times]3 table is embedded in a 3\[Times]4\[Times]3 SparseArray, \
using dimensions {1,3}, and inserting into position 2 of the remaining \
dimensions:"
}], "Text",
 CellChangeTimes->{{3.649215959721881*^9, 3.6492159619465227`*^9}, {
   3.649217195060066*^9, 3.649217303570533*^9}, 3.649297730959187*^9, {
   3.649297783803265*^9, 
   3.649297877195767*^9}},ExpressionUUID->"2e0b229a-8b2b-41b6-ac8c-\
0efcb80739a5"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"EmbedTable", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a", ",", "b", ",", "bb"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"c", ",", "d", ",", "dd"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "4", ",", "3"}], "}"}]}], "]"}], "//", 
  "Normal"}]], "Input",
 CellChangeTimes->{{3.649296972956545*^9, 3.649297016152676*^9}, {
   3.649297419214364*^9, 3.649297468408143*^9}, 3.649297560280476*^9, {
   3.6492976492850113`*^9, 3.649297653521824*^9}, {3.649297816956196*^9, 
   3.64929782354628*^9}},ExpressionUUID->"dbd4965f-083f-4da5-a208-\
9b5d56ea4d7b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "bb"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"c", ",", "d", ",", "dd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.649297016704064*^9, 3.649297233870961*^9, {3.649297425928911*^9, 
   3.6492974689213057`*^9}, {3.6492975609231777`*^9, 3.6492975693919373`*^9}, 
   3.649297654148027*^9, {3.649297817326782*^9, 
   3.649297824006606*^9}},ExpressionUUID->"201011ee-3654-4bd7-bc6f-\
aca4e8a9a96b"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["IntegerSets", "Subsubsection",
 CellChangeTimes->{{3.649215020154895*^9, 
  3.6492150239392757`*^9}},ExpressionUUID->"345982cf-7a52-487b-bb17-\
7755b17ffb85"],

Cell[TextData[{
 "This is actually just a flattened ",
 Cell[BoxData[
  FormBox[
   RowBox[{"Array", "[", 
    RowBox[{"List", ",", "k"}], "]"}], TraditionalForm]],ExpressionUUID->
  "cf9b3483-f8f7-458b-bb78-b677be5ecd74"]
}], "Text",
 CellChangeTimes->{{3.649296295392354*^9, 3.649296309780356*^9}, {
   3.649297189160522*^9, 3.649297191121367*^9}, 
   3.6506305238693*^9},ExpressionUUID->"466f92b8-7fdc-4ca2-8d9d-021fc4763f00"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntegerSets", "::", "usage"}], "=", 
   "\"\<IntegerSets[{\!\(\*SubscriptBox[\(k\), \
\(1\)]\),\!\(\*SubscriptBox[\(k\), \(2\)]\),\[Ellipsis]}] makes a flat list \
of all combinations of integers {\!\(\*SubscriptBox[\(i\), \
\(1\)]\),\!\(\*SubscriptBox[\(i\), \(2\)]\),\[Ellipsis]} for 1\[LessEqual]i\
\[LessEqual]k.   \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.649215029875051*^9, 3.649215128524508*^9}, {
  3.6492962872975883`*^9, 3.649296287475922*^9}, {3.649297197388928*^9, 
  3.649297200042532*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"7e0b0054-07f8-4887-bdaf-6a8c5fee1661"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntegerSets", "[", 
    RowBox[{"k", ":", 
     RowBox[{"{", "__Integer", "}"}]}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Array", "[", 
      RowBox[{"List", ",", "k"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Length", "[", "k", "]"}], "-", "1"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.649215138922161*^9, 3.6492151567106543`*^9}, {
  3.649215223391485*^9, 3.649215243691839*^9}, {3.649215314315557*^9, 
  3.649215326342205*^9}, {3.6492962744488297`*^9, 3.6492962825031013`*^9}, {
  3.649297204088854*^9, 3.649297210760614*^9}},
 CellLabel->"In[26]:=",ExpressionUUID->"0f8dd776-1b4a-4fc9-9b66-791be2b3f27e"]
}, Closed]],

Cell[CellGroupData[{

Cell["MakeProbTableOnce", "Subsubsection",
 CellChangeTimes->{
  3.649167154091372*^9},ExpressionUUID->"f9e51580-308b-4361-a38b-\
7397a22c91f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MakeProbTableOnce", "::", "usage"}], "=", 
   "\"\<MakeProbTableOnce[{{\[Psi],\[Ellipsis]},\[Ellipsis]},\[Omega][{a,b}],\
\[Theta],\!\(\*SubscriptBox[\(k\), \(max\)]\)] is used by MakeProbTable[] to \
construct a table of probabilities of all mutational configurations.  It \
takes a GF, or a GF that has already been differentiated to give a partial \
table, and constructs a series expansion in \[Omega][{a,b}] around \
\[Theta]/2.  Tabulates 0\!\(\*SubscriptBox[\(\[Ellipsis]k\), \(max\)]\) \
itations, and adds a final element that gives the residual \
probability.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.649167156304008*^9, 3.6491673578668623`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"438e530b-05b5-46e4-bbe3-9ae209a00085"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MakeProbTableOnce", "[", 
    RowBox[{"gf_", ",", "\[Omega]_", ",", "\[Theta]_", ",", "km_Integer"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cl", ",", "\[Delta]", ",", 
       RowBox[{"tr", "=", 
        RowBox[{"TensorRank", "[", "gf", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"tr", "\[Equal]", "0"}], ",", 
       RowBox[{
        RowBox[{"cl", "=", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["\[Theta]", "2"], ")"}], 
           RowBox[{"Range", "[", 
            RowBox[{"0", ",", "km"}], "]"}]], 
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"CoefficientList", "[", 
             RowBox[{
              RowBox[{"Series", "[", 
               RowBox[{
                RowBox[{"gf", "/.", 
                 RowBox[{"\[Omega]", "\[RuleDelayed]", 
                  RowBox[{"(", 
                   RowBox[{
                    FractionBox["\[Theta]", "2"], "-", "\[Delta]"}], 
                   ")"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"\[Delta]", ",", "0", ",", "km"}], "}"}]}], "]"}], 
              ",", "\[Delta]"}], "]"}], ",", 
            RowBox[{"km", "+", "1"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Append", "[", 
         RowBox[{"cl", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"gf", "/.", 
             RowBox[{"\[Omega]", ":>", "0"}]}], ")"}], "-", 
           RowBox[{"Total", "[", "cl", "]"}]}]}], "]"}]}], " ", 
       RowBox[{"(*", " ", 
        RowBox[{"appends", " ", "the", " ", "residual", " ", "probability"}], 
        " ", "*)"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MakeProbTableOnce", "[", 
           RowBox[{"#", ",", "\[Omega]", ",", "\[Theta]", ",", "km"}], "]"}], 
          "&"}], ",", "gf", ",", 
         RowBox[{"{", "tr", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"if", " ", "gf", " ", "is", " ", "a", " ", "table"}], ",", 
        " ", 
        RowBox[{
        "applies", " ", "the", " ", "function", " ", "to", " ", "the", " ", 
         "deepest", " ", "level"}]}], " ", "*)"}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.649154252175185*^9, 3.6491543163962927`*^9}, {
   3.6491543622028*^9, 3.649154402873364*^9}, {3.649154522478467*^9, 
   3.649154553956929*^9}, {3.6491550461251163`*^9, 3.649155049381855*^9}, 
   3.649158160096315*^9, {3.6491582210937634`*^9, 3.649158222211873*^9}, {
   3.649158531859087*^9, 3.649158537017366*^9}, {3.6491586021313457`*^9, 
   3.649158602283454*^9}, {3.649158717510057*^9, 3.6491587193085527`*^9}, {
   3.649159621820941*^9, 3.649159665556945*^9}, {3.6491598115545*^9, 
   3.649159816368734*^9}, {3.649160032195632*^9, 3.6491600346619177`*^9}, 
   3.649162192976671*^9, 3.64916222986653*^9, {3.6491624590985823`*^9, 
   3.6491625171719017`*^9}, {3.6491650600884247`*^9, 3.649165085741002*^9}, {
   3.6491673966762466`*^9, 3.649167442102985*^9}, {3.6492248697162027`*^9, 
   3.6492248786992207`*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"b2e4b5c0-a279-44f2-8951-ebcdf74b86cc"]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions for Yule", "Subsubsection",
 CellChangeTimes->{{3.810875748404017*^9, 
  3.81087575440092*^9}},ExpressionUUID->"a1c54c79-375c-4ed6-886e-\
043ec2b290a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PFi", "[", 
   RowBox[{"n_", ",", "i_"}], "]"}], ":=", " ", 
  RowBox[{
   UnderoverscriptBox["\[Product]", 
    RowBox[{"j", "=", "1"}], 
    RowBox[{"n", "-", "1"}]], 
   FractionBox[
    RowBox[{"(", 
     RowBox[{"i", "-", "j"}], ")"}], 
    RowBox[{"(", 
     RowBox[{"i", "+", "j"}], ")"}]], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "i", " ", "number", " ", "of", " ", "lineages", " ", "in", " ", "big", 
      " ", "yule", " ", "tree"}], ",", " ", 
     RowBox[{"n", " ", "lineages", " ", "in", " ", "sample"}]}], 
    "*)"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.793102276991338*^9, 3.7931022798293333`*^9}, {
  3.793102387893901*^9, 3.7931024607954283`*^9}, {3.793102569222548*^9, 
  3.793102587084777*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"337e8b4e-09fb-495e-a84a-2f63cbce4495"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pnotrecAlt", "[", "M_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "exponent", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"exponent", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", "i"], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", "M"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"exponent", " ", "=", " ", 
      RowBox[{"Reverse", "[", 
       RowBox[{"Accumulate", "[", 
        RowBox[{"Reverse", "[", "exponent", "]"}], "]"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"exponent", " ", "=", " ", 
      RowBox[{
       FractionBox[
        RowBox[{"-", "r"}], "s"], "exponent"}]}], ";", 
     SuperscriptBox["\[ExponentialE]", "exponent"]}], "*)"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"old", " ", "version"}], ",", " ", 
     RowBox[{"now", " ", "done", " ", "in", " ", "blockLikelihood"}]}], 
    "*)"}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.803261077771716*^9, 3.803261265659017*^9}, {
  3.8032614545993443`*^9, 3.803261465340371*^9}, {3.8032617941394672`*^9, 
  3.803261797548788*^9}, {3.803278701521681*^9, 3.8032787183443823`*^9}, {
  3.80328047287429*^9, 3.8032805106464977`*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"64678083-04e2-4d42-909b-3b2318963177"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pnotrec", "[", 
   RowBox[{"f_", ",", "r_", ",", "s_", ",", "Ne_", ",", "M_"}], "]"}], ":=", 
  " ", 
  SuperscriptBox["\[ExponentialE]", 
   RowBox[{"-", 
    RowBox[{"(", 
     RowBox[{
      FractionBox["r", "s"], "*", 
      RowBox[{
       UnderoverscriptBox["\[Sum]", 
        RowBox[{"i", "=", "f"}], "M"], 
       FractionBox["1", "i"]}]}], ")"}]}]], 
  RowBox[{"(*", 
   RowBox[{"probability", " ", "of", " ", "no", " ", "recombination"}], " ", 
   "*)"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.793103892536036*^9, 3.793103935959095*^9}, {
  3.793103980632011*^9, 3.793104039319973*^9}, {3.793347472097168*^9, 
  3.793347478447082*^9}, {3.7933475619280767`*^9, 3.793347565514811*^9}, {
  3.793619403962264*^9, 3.7936194275636187`*^9}, {3.793690697633366*^9, 
  3.793690705854048*^9}, {3.7963643336585712`*^9, 3.796364334094859*^9}, {
  3.7963645168022738`*^9, 3.796364517144459*^9}, {3.796367462117738*^9, 
  3.796367462580122*^9}, {3.796378999577331*^9, 3.7963789999194803`*^9}, {
  3.7964493694680758`*^9, 3.796449387879458*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"c4ce3183-dba3-4dba-87b5-029159c9a34f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"m", "[", 
   RowBox[{"s_", ",", "r_", ",", "n_"}], "]"}], ":=", 
  RowBox[{"Max", "[", 
   RowBox[{"1", ",", 
    RowBox[{
     FractionBox[
      RowBox[{"r", "*", "n"}], "s"], "*", 
     RowBox[{
      UnderoverscriptBox["\[Sum]", 
       RowBox[{"i", "=", "1"}], 
       RowBox[{"n", "-", "1"}]], 
      FractionBox["1", "i"]}]}]}], "]"}], 
  RowBox[{"(*", 
   RowBox[{"correction", " ", "factor"}], "*)"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7933545367779617`*^9, 3.7933546575760603`*^9}, {
  3.793355906483397*^9, 3.793355907136292*^9}, {3.793385342661409*^9, 
  3.793385347257894*^9}, {3.7936194328444357`*^9, 3.793619450053961*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"b6855bba-dd1f-4b75-9715-25b9fcfe3450"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PELN", "::", "usage"}], "=", 
    "\"\<Returns the probability for a binning configuration {early, late, \
non-recombining} with E=early, L=late, n=total number of lineages.\>\""}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"E", "=", 
     RowBox[{
     "size", " ", "of", " ", "early", " ", "recombinant", " ", "family"}]}], 
    ",", " ", 
    RowBox[{"L", " ", "=", " ", 
     RowBox[{
     "number", " ", "of", " ", "late", " ", "recombining", " ", 
      "singletons"}]}], ",", " ", 
    RowBox[{"n", "=", 
     RowBox[{"sample", " ", "size"}]}], ",", " ", 
    RowBox[{
     RowBox[{"n", "-", "E", "-", "L"}], "=", 
     RowBox[{
     "number", " ", "of", " ", "lineages", " ", "that", " ", "did", " ", 
      "not", " ", "escape"}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PELN", "[", 
    RowBox[{
    "E_", ",", " ", "L_", ",", " ", "n_", ",", " ", "s_", ",", " ", "r_", ",",
      "Ne_", ",", "M_", ",", "pnorec_", ",", "pfisf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"prec", ",", " ", "ExpectPf", ",", " ", 
       RowBox[{"correctionF", " ", "=", " ", 
        RowBox[{"m", "[", 
         RowBox[{"s", ",", "r", ",", "n"}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"pfisf", " ", "=", " ", 
        RowBox[{"Differences", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"PFi", "[", 
            RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{"n", "-", "1"}], ",", "M"}], "]"}]}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"pnorec", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"pnotrec", "[", 
           RowBox[{"#", ",", "r", ",", "s", ",", "Ne", ",", "M"}], "]"}], 
          "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"n", ",", "M"}], "]"}]}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"prec", " ", "=", " ", 
       RowBox[{"1", "-", "pnorec"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ExpectPf", " ", "=", " ", 
       RowBox[{"Total", "[", 
        RowBox[{
         SuperscriptBox["pnorec", 
          RowBox[{"n", "-", "L"}]], "*", 
         SuperscriptBox["prec", "L"], "*", "pfisf"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"E", "\[GreaterEqual]", "2"}], ",", 
        RowBox[{"ExpectPf", "*", " ", 
         FractionBox[
          RowBox[{"r", "*", "n"}], 
          RowBox[{"s", "*", "correctionF"}]], "*", 
         FractionBox["1", 
          RowBox[{"E", 
           RowBox[{"(", 
            RowBox[{"E", "-", "1"}], ")"}]}]], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"n", "-", "1"}], ")"}], "*", 
            RowBox[{"Binomial", "[", 
             RowBox[{
              RowBox[{"n", "-", "2"}], ",", 
              RowBox[{"E", "-", "2"}]}], "]"}], "*", 
            RowBox[{"Boole", "[", 
             RowBox[{
              RowBox[{"L", "+", "E"}], "==", "n"}], "]"}]}], "+", 
           RowBox[{"Binomial", "[", 
            RowBox[{
             RowBox[{"n", "-", "1"}], ",", "L"}], "]"}]}], ")"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"E", "\[Equal]", "1"}], ",", 
          RowBox[{"ExpectPf", "*", 
           FractionBox[
            RowBox[{"r", "*", "n"}], 
            RowBox[{"s", "*", "correctionF"}]], "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Boole", "[", 
              RowBox[{
               RowBox[{"L", "+", "1"}], "\[Equal]", "n"}], "]"}], "+", 
             RowBox[{
              RowBox[{"Binomial", "[", 
               RowBox[{
                RowBox[{"n", "-", "1"}], ",", "L"}], "]"}], "*", 
              RowBox[{
               UnderoverscriptBox["\[Sum]", 
                RowBox[{"i", "=", "2"}], 
                RowBox[{"n", "-", "1"}]], 
               FractionBox["1", "i"]}]}], "+", 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"S", "=", "2"}], "n"], 
              FractionBox[
               RowBox[{"Binomial", "[", 
                RowBox[{
                 RowBox[{"n", "-", "S"}], ",", " ", 
                 RowBox[{"L", "-", "S", "+", "1"}]}], "]"}], 
               RowBox[{"S", "-", "1"}]]}]}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"correctionF", ">", "1"}], ",", 
            RowBox[{"ExpectPf", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"Binomial", "[", 
                   RowBox[{"n", ",", "L"}], "]"}], 
                  RowBox[{"(", 
                   RowBox[{"1", "-", "correctionF"}], ")"}]}]}], "]"}], "+", 
               RowBox[{
                FractionBox[
                 RowBox[{"r", "*", "n"}], 
                 RowBox[{"s", "*", "correctionF"}]], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   FractionBox["1", "n"], "*", 
                   RowBox[{"Boole", "[", 
                    RowBox[{"L", "\[Equal]", "n"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"Binomial", "[", 
                    RowBox[{
                    RowBox[{"n", "-", "1"}], ",", 
                    RowBox[{"L", "-", "1"}]}], "]"}], "*", 
                   RowBox[{
                    UnderoverscriptBox["\[Sum]", 
                    RowBox[{"i", "=", "2"}], 
                    RowBox[{"n", "-", "1"}]], 
                    FractionBox["1", "i"]}]}], "+", 
                  RowBox[{
                   UnderoverscriptBox["\[Sum]", 
                    RowBox[{"S", "=", "2"}], "n"], 
                   RowBox[{
                    RowBox[{"Binomial", "[", 
                    RowBox[{
                    RowBox[{"n", "-", "S"}], ",", 
                    RowBox[{"n", "-", "L"}]}], "]"}], "*", 
                    FractionBox["1", 
                    RowBox[{"S", 
                    RowBox[{"(", 
                    RowBox[{"S", "-", "1"}], ")"}]}]]}]}]}], ")"}]}]}], 
              ")"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"ExpectPf", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Binomial", "[", 
                 RowBox[{"n", ",", "L"}], "]"}], 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"r", "*", "n"}], "s"], 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    UnderoverscriptBox["\[Sum]", 
                    RowBox[{"i", "=", "1"}], 
                    RowBox[{"n", "-", "1"}]], 
                    FractionBox["1", "i"]}], "-", 
                    RowBox[{
                    FractionBox["L", "n"], 
                    RowBox[{
                    UnderoverscriptBox["\[Sum]", 
                    RowBox[{"i", "=", "2"}], 
                    RowBox[{"n", "-", "1"}]], 
                    FractionBox["1", "i"]}]}]}], ")"}]}]}], ")"}]}], "+", 
               RowBox[{
                FractionBox[
                 RowBox[{"r", "*", "n"}], "s"], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   FractionBox["1", "n"], "*", 
                   RowBox[{"Boole", "[", 
                    RowBox[{"L", "\[Equal]", "n"}], "]"}]}], "+", 
                  RowBox[{
                   UnderoverscriptBox["\[Sum]", 
                    RowBox[{"S", "=", "2"}], "n"], 
                   RowBox[{
                    RowBox[{"Binomial", "[", 
                    RowBox[{
                    RowBox[{"n", "-", "S"}], ",", 
                    RowBox[{"n", "-", "L"}]}], "]"}], "*", 
                    FractionBox["1", 
                    RowBox[{"S", 
                    RowBox[{"(", 
                    RowBox[{"S", "-", "1"}], ")"}]}]]}]}]}], ")"}]}]}], 
              ")"}]}]}], "]"}]}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\t"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7930137195309067`*^9, 3.793013847210245*^9}, {
   3.793014242460827*^9, 3.7930145234218597`*^9}, {3.793014567126438*^9, 
   3.793014590933324*^9}, {3.793014697798935*^9, 3.793015080715281*^9}, {
   3.793015120142455*^9, 3.7930151957964897`*^9}, {3.7930874568432207`*^9, 
   3.793087457888007*^9}, {3.793089271209659*^9, 3.793089290903883*^9}, {
   3.793104583496112*^9, 3.7931046316564617`*^9}, {3.793104804361657*^9, 
   3.793104806937264*^9}, {3.793104860239303*^9, 3.7931049663787403`*^9}, {
   3.7931051202766247`*^9, 3.793105196922881*^9}, {3.793105529399926*^9, 
   3.793105577888242*^9}, {3.7931057220973377`*^9, 3.793105901218216*^9}, {
   3.793105996364043*^9, 3.793106035412393*^9}, {3.793106667257285*^9, 
   3.7931066673345003`*^9}, {3.793106784152626*^9, 3.793106812486288*^9}, {
   3.793342734086027*^9, 3.793342741355097*^9}, {3.793347572836062*^9, 
   3.793347577929693*^9}, {3.793348006668557*^9, 3.793348048108362*^9}, {
   3.793348156935349*^9, 3.7933482127896137`*^9}, {3.7933484704056997`*^9, 
   3.793348479883956*^9}, {3.793348717741835*^9, 3.793348722062592*^9}, {
   3.793349465072155*^9, 3.793349468774022*^9}, {3.793349515598893*^9, 
   3.793349526397534*^9}, 3.793349678785697*^9, {3.793354710980336*^9, 
   3.793354728264472*^9}, {3.793354960932582*^9, 3.793354974314348*^9}, {
   3.793355874298142*^9, 3.793355996299102*^9}, {3.793356336400633*^9, 
   3.7933563461426973`*^9}, {3.7933564436797037`*^9, 
   3.7933564812885447`*^9}, {3.793356526817429*^9, 3.793356549461308*^9}, {
   3.7933565815845203`*^9, 3.7933568307231817`*^9}, 3.7933852754179497`*^9, {
   3.793385336762567*^9, 3.7933853392855463`*^9}, {3.7933854155319443`*^9, 
   3.793385452148594*^9}, 3.793386009451456*^9, 3.793386121439204*^9, {
   3.793387217767166*^9, 3.7933872588554363`*^9}, {3.793619464991037*^9, 
   3.793619601738902*^9}, {3.79369071244948*^9, 3.793690712764345*^9}, {
   3.794651570626383*^9, 3.794651576037011*^9}, {3.796362563308557*^9, 
   3.79636258612213*^9}, {3.796366711805326*^9, 3.796366716718664*^9}, {
   3.796448909644513*^9, 3.796448909838498*^9}, {3.803188878594203*^9, 
   3.803188890626742*^9}, {3.803188922641655*^9, 3.803188982196756*^9}, {
   3.803189044472898*^9, 3.80318907481386*^9}, {3.80318922483559*^9, 
   3.803189274669828*^9}, {3.803279935576763*^9, 3.8032799482880993`*^9}, {
   3.803401309970079*^9, 3.803401316012422*^9}, {3.803401349323488*^9, 
   3.803401367572204*^9}, {3.8034014889973907`*^9, 3.8034014930555077`*^9}, {
   3.8034017258390303`*^9, 3.8034017292957363`*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"c1321a98-9f0f-43e6-8272-ce8d8853da73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "gives", " ", "the", " ", "number", " ", "of", " ", "ways", " ", "to", 
     " ", "divide", " ", "n", " ", "into", " ", "3", " ", "buckets"}], ",", 
    " ", 
    RowBox[{"including", " ", "empty", " ", "bucket"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"partitions", "[", "X_", "]"}], ":=", 
     RowBox[{"Catenate", "[", 
      RowBox[{"Permutations", "/@", 
       RowBox[{"IntegerPartitions", "[", 
        RowBox[{"X", ",", 
         RowBox[{"{", "3", "}"}], ",", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "X"}], "]"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "given", " ", "the", " ", "types", " ", "of", " ", "partitions"}], ",", 
     " ", 
     RowBox[{
     "make", " ", "all", " ", "combinations", " ", "for", " ", "our", " ", 
      "sample"}], ",", " ", 
     RowBox[{
     "and", " ", "calculate", " ", "probability", " ", "of", " ", "this", " ", 
      RowBox[{"configuration", ".", " ", "returns"}], " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"partition", ",", " ", "probability", ",", " ", 
         RowBox[{
         "sample_configuration", " ", "following", " ", "coalescence"}]}], 
        ")"}], ".", " ", "Hold"}], " ", "is", " ", "used", " ", "to", " ", 
      "avoid", " ", "having", " ", "to", " ", "specify", " ", "all", " ", 
      "parameters", " ", "prior", " ", "to", " ", "taking", " ", "inverse", 
      " ", "laplace", " ", 
      RowBox[{"transforms", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"part3", "[", 
      RowBox[{
      "a_List", ",", "p_List", ",", "s_", ",", "r_", ",", "Ne_", ",", "M_"}], 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"f", ",", "sym", ",", "prob", ",", "result"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Attributes", "[", "f", "]"}], "=", "Orderless"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"prob", "=", 
         RowBox[{"Peln", "[", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"p", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"Total", "[", "p", "]"}], ",", "s", ",", "r", ",", "Ne", 
           ",", "M"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sym", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", 
            RowBox[{"\"\<x\>\"", ",", "Temporary"}], "]"}], "&"}], "/@", 
          "p"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"result", "=", 
         RowBox[{"ReplaceList", "[", 
          RowBox[{
           RowBox[{"f", "@@", "a"}], ",", 
           RowBox[{
            RowBox[{"f", "@@", 
             RowBox[{"MapThread", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Pattern", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"Repeated", "[", 
                   RowBox[{"_", ",", 
                    RowBox[{"{", "#2", "}"}]}], "]"}]}], "]"}], "&"}], ",", 
               RowBox[{"{", 
                RowBox[{"sym", ",", "p"}], "}"}]}], "]"}]}], "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"p", ",", "prob", ",", 
              RowBox[{"List", "/@", "sym"}]}], "}"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "result", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.793089083789557*^9, 3.793089095645548*^9}, {
  3.793090437469775*^9, 3.79309044490256*^9}, {3.793104637545109*^9, 
  3.793104638894844*^9}, {3.793104794983972*^9, 3.793104816248155*^9}, {
  3.793471347603793*^9, 3.793471354377269*^9}, {3.79361961189185*^9, 
  3.793619731251933*^9}, {3.7936198334537573`*^9, 3.793619854940612*^9}, {
  3.7936909866975613`*^9, 3.79369099879909*^9}, {3.7946406080216637`*^9, 
  3.794640710929585*^9}, {3.794651638558587*^9, 3.794651638893318*^9}, {
  3.794740707859797*^9, 3.794740735613426*^9}, {3.795774418193749*^9, 
  3.795774451997957*^9}, {3.795845813689033*^9, 3.7958458185462303`*^9}, {
  3.8027751941293497`*^9, 3.802775196692072*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"2219d84b-d9d1-4ab5-b857-af6df0b768b9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cprob", "::", "usage"}], "=", 
   "\"\<Returns all PELN probabilities for all configurations from n=2 to \
n=number of lineages in sample.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cprob", "[", " ", 
    RowBox[{
    "numSamples_", ",", "s_", ",", "r_", ",", "Ne_", ",", "M_", ",", 
     "pnorecAll_", ",", "pfisfList_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"partitionslist", ",", " ", "results"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"partitionslist", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"partitions", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "2", ",", "numSamples"}], "}"}]}], "]"}], ",", 
         "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "subset", " ", "pnorecAll", " ", "depending", " ", "on", " ", "n"}], 
        ",", " ", 
        RowBox[{
         RowBox[{"if", " ", "n"}], " ", "=", " ", "2"}], ",", " ", 
        RowBox[{"retain", " ", "all"}], ",", " ", 
        RowBox[{
         RowBox[{"otherwise", " ", "subset", " ", "i"}], "=", 
         RowBox[{"n", "-", 
          RowBox[{"2", " ", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"1", "+", "i"}], ";;", 
             RowBox[{"-", "1"}]}], "]"}], "]"}]}]}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"results", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Peln", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"Total", "[", "#", "]"}]}], "]"}], "\[Rule]", 
          RowBox[{"PELN", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"Total", "[", "#", "]"}], ",", "s", ",", "r", ",", "Ne", 
            ",", "M", ",", 
            RowBox[{"pnorecAll", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{"Total", "[", "#", "]"}], "-", "1"}], ";;", 
               RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
            RowBox[{"pfisfList", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"Total", "[", "#", "]"}], "-", "1"}], "]"}], "]"}]}], 
           "]"}]}], "&"}], "/@", "partitionslist"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "results", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.794825322636507*^9, 3.794825345536665*^9}, {
  3.8019820220100803`*^9, 3.8019820471246147`*^9}, {3.8019821147032948`*^9, 
  3.8019821219994793`*^9}, {3.8031890061034517`*^9, 3.803189037456661*^9}, {
  3.803189080075808*^9, 3.8031891041847343`*^9}, {3.803189305557684*^9, 
  3.803189329814596*^9}, {3.803189468312564*^9, 3.803189469831874*^9}, {
  3.803190896590426*^9, 3.8031909421962147`*^9}, {3.803191200335525*^9, 
  3.803191269101042*^9}, {3.803279953969747*^9, 3.8032799958312387`*^9}, {
  3.8108770418375397`*^9, 3.810877057052868*^9}, {3.810915214734852*^9, 
  3.810915225350534*^9}, {3.8109152965196133`*^9, 3.810915296737791*^9}, {
  3.810917254412305*^9, 3.810917254765442*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"9476a9d6-2a9e-4119-912a-9dc210b03947"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cprobOld", "::", "usage"}], "=", 
   "\"\<Returns all PELN probabilities for all configurations from n=2 to \
n=number of lineages in sample.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cprobOld", "[", " ", 
    RowBox[{
    "numSamples_", ",", "s_", ",", "r_", ",", "Ne_", ",", "M_", ",", 
     "pnorecAll_", ",", "pfisfList_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"partitionslist", ",", " ", "results"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"partitionslist", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"partitions", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "2", ",", "numSamples"}], "}"}]}], "]"}], ",", 
         "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "subset", " ", "pnorecAll", " ", "depending", " ", "on", " ", "n"}], 
        ",", " ", 
        RowBox[{
         RowBox[{"if", " ", "n"}], " ", "=", " ", "2"}], ",", " ", 
        RowBox[{"retain", " ", "all"}], ",", " ", 
        RowBox[{
         RowBox[{"otherwise", " ", "subset", " ", "i"}], "=", 
         RowBox[{"n", "-", 
          RowBox[{"2", " ", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"1", "+", "i"}], ";;", 
             RowBox[{"-", "1"}]}], "]"}], "]"}]}]}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"results", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Peln", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"Total", "[", "#", "]"}], ",", "s", ",", "r", ",", "Ne", 
            ",", "M"}], "]"}], "\[Rule]", 
          RowBox[{"PELN", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"Total", "[", "#", "]"}], ",", "s", ",", "r", ",", "Ne", 
            ",", "M", ",", 
            RowBox[{"pnorecAll", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{"Total", "[", "#", "]"}], "-", "1"}], ";;", 
               RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
            RowBox[{"pfisfList", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"Total", "[", "#", "]"}], "-", "1"}], "]"}], "]"}]}], 
           "]"}]}], "&"}], "/@", "partitionslist"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "results", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.794825322636507*^9, 3.794825345536665*^9}, {
  3.8019820220100803`*^9, 3.8019820471246147`*^9}, {3.8019821147032948`*^9, 
  3.8019821219994793`*^9}, {3.8031890061034517`*^9, 3.803189037456661*^9}, {
  3.803189080075808*^9, 3.8031891041847343`*^9}, {3.803189305557684*^9, 
  3.803189329814596*^9}, {3.803189468312564*^9, 3.803189469831874*^9}, {
  3.803190896590426*^9, 3.8031909421962147`*^9}, {3.803191200335525*^9, 
  3.803191269101042*^9}, {3.803279953969747*^9, 3.8032799958312387`*^9}, {
  3.8108770418375397`*^9, 3.810877057052868*^9}, {3.810915214734852*^9, 
  3.810915225350534*^9}, {3.8109152965196133`*^9, 3.810915296737791*^9}, {
  3.810917243360602*^9, 3.8109172463782997`*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"80f40fa2-bc22-4cb4-aa28-e8f98aa4e390"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sumprobs", "::", "usage"}], "=", 
   "\"\<returns sumP[i] for i in [2,total number of lineages]. Sum of PELN \
probabilities. The higher the number of lineages and the smaller s, this sum \
increasingly deviates from 1.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sumprobs", "[", 
   RowBox[{"subs_List", ",", "filtervalue_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "filterresults", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filterresults", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"subs", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "3"}], "]"}], "]"}], "\[Equal]", 
          "filtervalue"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Total", "[", 
      RowBox[{"filterresults", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.795847854402788*^9, 3.795847921822454*^9}, {
  3.795848156742961*^9, 3.795848165696829*^9}, {3.7958482386281567`*^9, 
  3.7958482491673326`*^9}, {3.797144286949567*^9, 3.797144291244321*^9}, {
  3.797146375360136*^9, 3.797146378386108*^9}, {3.8031089185457172`*^9, 
  3.8031089203530407`*^9}, {3.803109676918631*^9, 3.803109701554734*^9}, {
  3.8031891064727173`*^9, 3.803189197453341*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"416f1a63-f050-4cac-9b49-7454273f95ca"]
}, Closed]],

Cell[CellGroupData[{

Cell["Precalculate PELN probabilities Yule", "Subsubsection",
 CellChangeTimes->{{3.811237895087449*^9, 
  3.8112379252211637`*^9}},ExpressionUUID->"f5702d31-736f-4b1e-b493-\
001e0fcc9e27"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PreCalculateRandomVariablesYule", "[", 
   RowBox[{
   "N_", ",", "s_", ",", " ", "numSamples_", ",", " ", "recPerBlock_List"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "M", ",", "pnorecList", ",", " ", "pfisfList", ",", " ", "pnorecAll", 
      ",", " ", "PelnProbsPerBlock", ",", " ", "sumProbsPerBlock"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"M", "=", 
      RowBox[{"Ceiling", "[", 
       RowBox[{"4", "*", "N", "*", "s"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"precalculate", " ", "lists", " ", "required"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"pnorecList", "=", 
      RowBox[{"pnotrecAlt", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pfisfList", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Differences", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"PFi", "[", 
            RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{"n", "-", "1"}], ",", "M"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "2", ",", "numSamples"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "using", " ", "precalculated", " ", "values", " ", "calculate", " ", 
       "table", " ", "for", " ", "each", " ", "r", " ", "distance"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"pnorecAll", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           FractionBox[
            RowBox[{"-", "#"}], "s"], "pnorecList"}]], "&"}], "/@", 
        "recPerBlock"}], "//", "Parallelize"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"(*", 
      RowBox[{
      "for", " ", "PelnProbsPerBlock", " ", "we", " ", "need", " ", "to", " ",
        "zip", " ", "iterate", " ", "over", " ", "recPerBlock", " ", "and", 
       " ", "pnorecAll"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"PelnProbsPerBlock", " ", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"cprob", "[", 
          RowBox[{"numSamples", ",", " ", "s", ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "N", ",", " ", "M", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", ",", "pfisfList"}], "]"}], 
         "&"}], "/@", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"recPerBlock", ",", " ", "pnorecAll"}], "}"}], "]"}]}], "//",
        "Parallelize"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"sumProbsPerBlock", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"sumP", "[", "i", "]"}], "\[Rule]", 
              RowBox[{"sumprobs", "[", 
               RowBox[{"#", ",", "i"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "2", ",", "numSamples"}], "}"}]}], "]"}], 
           "&"}], "/@", "PelnProbsPerBlock"}], "//", "Parallelize"}]}], ";"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"MapThread", "[", 
       RowBox[{"Join", ",", 
        RowBox[{"{", 
         RowBox[{"PelnProbsPerBlock", ",", "sumProbsPerBlock"}], "}"}]}], 
       "]"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PelnToSparseArray", "/@", "PelnProbsPerBlock"}], "//", 
      "Parallelize"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8109020626843777`*^9, 3.810902274302711*^9}, {
  3.810902315039351*^9, 3.810902377447297*^9}, {3.810902421528193*^9, 
  3.810902422710272*^9}, {3.810914122092146*^9, 3.8109141435534277`*^9}, {
  3.810914186597312*^9, 3.810914234060766*^9}, {3.810914940159865*^9, 
  3.810915021403561*^9}, {3.8109153631733007`*^9, 3.810915363702138*^9}, {
  3.8112374319350843`*^9, 3.8112374606577463`*^9}, {3.811237584768116*^9, 
  3.811237610935259*^9}, {3.811237761407425*^9, 3.811237793511125*^9}, {
  3.8114809416668253`*^9, 3.811480978893836*^9}, {3.81334207230162*^9, 
  3.813342074714911*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"ac4b5a23-b945-4dd4-9848-a93fa0fedc6e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PelnToSparseArray", "[", "PelnList_List", "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "rules", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rules", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"AddOne", "[", 
          RowBox[{"StripFunction", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "\[Rule]", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "PelnList"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SparseArray", "[", "rules", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811237596943424*^9, 3.811237603860264*^9}, {
  3.811237638636639*^9, 3.81123773421344*^9}, {3.8114812408308973`*^9, 
  3.8114812450034933`*^9}},
 CellLabel->"In[62]:=",ExpressionUUID->"a3280505-36fe-4518-a314-13b03b9acdf1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReplacePeln", "[", 
   RowBox[{"PelnAr_SparseArray", ",", "SymbAr_SparseArray"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Peln", ",", " ", "sumP", ",", " ", "ArRules", ",", " ", "dim", ",", " ",
       "f", ",", " ", "SumProbs"}], "}"}], " ", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ArRules", "=", 
      RowBox[{"ArrayRules", "[", "SymbAr", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dim", "=", 
      RowBox[{"Dimensions", "[", "SymbAr", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SumProbs", "=", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"PelnAr", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Peln", "[", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "]"}], ":=", 
      RowBox[{"PelnAr", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"i", "+", "1"}], ",", 
         RowBox[{"j", "+", "1"}], ",", 
         RowBox[{"k", "+", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sumP", "[", "l_", "]"}], ":=", 
      RowBox[{"SumProbs", "[", 
       RowBox[{"[", "l", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"key_", "\[Rule]", "val_"}], "]"}], ":=", 
      RowBox[{"key", "\[Rule]", 
       RowBox[{"Evaluate", "[", "val", "]"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"ArRules", "=", 
      RowBox[{"f", "/@", "ArRules"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"SparseArray", "[", 
      RowBox[{"ArRules", ",", " ", "dim"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811224164703328*^9, 3.811224202159939*^9}, {
   3.811224403458606*^9, 3.8112244049042664`*^9}, {3.811224548842519*^9, 
   3.8112245497495832`*^9}, {3.8112249422901087`*^9, 
   3.8112249860257177`*^9}, {3.811225119128207*^9, 3.811225120639517*^9}, {
   3.811225288192069*^9, 3.811225320448379*^9}, {3.811225467185582*^9, 
   3.811225468806909*^9}, {3.811225527586514*^9, 3.811225535343902*^9}, {
   3.8112257068110847`*^9, 3.811225730972015*^9}, {3.811226470759408*^9, 
   3.811226524280732*^9}, {3.811227331728712*^9, 3.811227332193001*^9}, {
   3.811227368494772*^9, 3.811227371027738*^9}, 3.8112371253436327`*^9, {
   3.813305849162109*^9, 3.8133058518741198`*^9}, {3.813305933754225*^9, 
   3.8133059362816563`*^9}, {3.81330710053806*^9, 3.813307102975919*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"f77a4d16-66ad-4fa3-82c5-90b15261e53f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReplacePelnGF", "[", 
   RowBox[{"PelnAr_SparseArray", ",", "GF_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Peln", ",", " ", "sumP", ",", " ", "SumProbs", ",", " ", "result"}], 
     "}"}], " ", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SumProbs", "=", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"PelnAr", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Peln", "[", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "]"}], ":=", 
      RowBox[{"PelnAr", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"i", "+", "1"}], ",", 
         RowBox[{"j", "+", "1"}], ",", 
         RowBox[{"k", "+", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sumP", "[", "l_", "]"}], ":=", 
      RowBox[{"SumProbs", "[", 
       RowBox[{"[", "l", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"Evaluate", "[", "GF", "]"}]}], ";", "\[IndentingNewLine]", 
     "result"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811224164703328*^9, 3.811224202159939*^9}, {
   3.811224403458606*^9, 3.8112244049042664`*^9}, {3.811224548842519*^9, 
   3.8112245497495832`*^9}, {3.8112249422901087`*^9, 
   3.8112249860257177`*^9}, {3.811225119128207*^9, 3.811225120639517*^9}, {
   3.811225288192069*^9, 3.811225320448379*^9}, {3.811225467185582*^9, 
   3.811225468806909*^9}, {3.811225527586514*^9, 3.811225535343902*^9}, {
   3.8112257068110847`*^9, 3.811225730972015*^9}, {3.811226470759408*^9, 
   3.811226524280732*^9}, {3.811227331728712*^9, 3.811227332193001*^9}, {
   3.811227368494772*^9, 3.811227371027738*^9}, 3.8112371253436327`*^9, {
   3.813305849162109*^9, 3.8133058518741198`*^9}, {3.813305933754225*^9, 
   3.8133059362816563`*^9}, {3.81330710053806*^9, 3.813307102975919*^9}, {
   3.8134723851726227`*^9, 3.813472429496778*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"744689c5-dd14-496e-b72e-9f71fe6e1c53"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SubstitutionDispatchTableGF", "[", "numLineages_Integer", "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "sumFirstTwo", ",", " ", "allBins", ",", "t1", ",", "t2", ",", " ", 
      "substitutionTableY"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"sumFirstTwo", "[", "inputList_List", "]"}], ":=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"inputList", "[", 
         RowBox[{"[", 
          RowBox[{";;", "2"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Total", "[", "inputList", "]"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"allBins", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"partitions", "[", "i", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2", ",", "numLineages"}], "}"}]}], "]"}], ",", 
        "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"allBins", "=", 
      RowBox[{"sumFirstTwo", "/@", "allBins"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"t1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ReplacePart", "[", 
         RowBox[{
          RowBox[{"Peln", "[", 
           RowBox[{
           "_", ",", "_", ",", "_", ",", "_", ",", "_", ",", "_", ",", "_"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "\[Rule]", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"2", "\[Rule]", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{"3", "\[Rule]", 
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], "]"}], "&"}], "/@",
        "allBins"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"t2", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Peln", "@@", 
         RowBox[{"Sequence", " ", "[", "#", "]"}]}], "&"}], "/@", 
       "allBins"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"substitutionTableY", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{"Rule", ",", 
        RowBox[{"{", 
         RowBox[{"t1", ",", "t2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Dispatch", "[", "substitutionTableY", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811237957345186*^9, 3.811238126781893*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"1bf9a951-5976-48ad-bae9-b7e87aeb69d9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"StripFunction", "[", "f_", "]"}], ":=", 
  RowBox[{"List", "[", 
   RowBox[{"Sequence", "@@", "f"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811481095841872*^9, 3.8114811186843767`*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"62e56fa9-72bb-45df-b755-f8a7db27345c"]
}, Closed]],

Cell[CellGroupData[{

Cell["Interpolation functions", "Subsubsection",
 CellChangeTimes->{{3.811487261312405*^9, 
  3.811487265848751*^9}},ExpressionUUID->"950c66d2-9a4f-444d-9b3d-\
5189465fd6db"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CallInterpolation", "[", 
   RowBox[{"variablesList_List", ",", " ", "InterpolationSpAr_SparseArray"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rules", ",", " ", "result"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rules", "=", 
      RowBox[{"ArrayRules", "[", "InterpolationSpAr", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"key_", "\[Rule]", "InterpolF_"}], "]"}], ":=", 
      RowBox[{"key", "\[Rule]", 
       RowBox[{"InterpolF", "[", 
        RowBox[{"Sequence", "@@", "variablesList"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", "#", "]"}], "&"}], "/@", "rules"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811245044354124*^9, 3.811245096304245*^9}, {
  3.811245131602303*^9, 3.8112452026673403`*^9}, {3.81124523313373*^9, 
  3.8112452858048067`*^9}, {3.811246493812994*^9, 3.8112465097314577`*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"dbc000ec-25cf-4b5f-8ffd-b7a4275b9994"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReturnInterpolationFunction", "[", 
   RowBox[{
   "MutypeGF_SparseArray", ",", " ", "theta_", ",", " ", "numPoints_", ",", 
    " ", "startTa_", ",", " ", "endTa_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "arrayRules", ",", " ", "interpolatedProbSel"}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"arrayRules", "=", 
      RowBox[{"ArrayRules", "[", "MutypeGF", "]"}]}], ";", "\n", 
     RowBox[{"t", "=", 
      RowBox[{"BlockRules", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Theta]", "\[Rule]", "theta"}], "}"}], ",", "arrayRules"}],
        "]"}]}], ";", "\n", 
     RowBox[{"interpolatedProbSel", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "->", 
          RowBox[{"FunctionInterpolation", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"Ta", ",", "startTa", ",", "endTa"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]", ",", "0", ",", "12"}], "}"}], ",", " ", 
            RowBox[{"InterpolationPoints", "\[Rule]", "numPoints"}]}], 
           "]"}]}], "&"}], "/@", "t"}], "//", "Parallelize"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"SparseArray", "[", "interpolatedProbSel", "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.81149800636469*^9, 3.81149800667127*^9}, {
  3.811498042399246*^9, 3.811498088432062*^9}, {3.8114981282302647`*^9, 
  3.811498228720768*^9}, {3.811498791557887*^9, 3.811498796174204*^9}, {
  3.8114988367088337`*^9, 3.811498906061268*^9}, {3.811499030957502*^9, 
  3.811499059149037*^9}, {3.811499613790802*^9, 3.811499621554377*^9}, {
  3.812712899714528*^9, 3.812712903377243*^9}, {3.8127188630145597`*^9, 
  3.812718866660728*^9}, {3.81282237006498*^9, 3.812822375824401*^9}, {
  3.812865849412932*^9, 3.812865853267044*^9}, {3.8128741305884743`*^9, 
  3.812874135305099*^9}, {3.8128917254564857`*^9, 3.812891729295637*^9}, {
  3.812905094155444*^9, 3.8129050957849607`*^9}, {3.814202620511095*^9, 
  3.814202632990259*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"3f269151-0fe3-4260-b615-01890399dbd2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakeNumProbTableTheta", "[", 
   RowBox[{
   "TwoParamInterpol_", ",", "Ta_", ",", "s_", ",", "N_", ",", "recPerBlock_",
     ",", " ", "mutypeGFn_", ",", " ", "theta_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"alphaPerBlock", ",", " ", 
      RowBox[{"alphaCutOff", "=", "12"}], ",", " ", "alphaCutOffPosition", 
      ",", " ", "repeating", ",", " ", 
      RowBox[{"result", "=", 
       RowBox[{"{", "}"}]}], ",", " ", "subsMutypeGFn"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"subsMutypeGFn", "=", 
      RowBox[{"BlockRules", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Theta]", "\[Rule]", "theta"}], "}"}], ",", "mutypeGFn"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"s", "\[Equal]", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Table", "[", 
         RowBox[{"subsMutypeGFn", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "recPerBlock", "]"}]}], "}"}]}], "]"}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"alphaPerBlock", " ", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"alphaFroms", "[", 
         RowBox[{"s", ",", "#", ",", "N"}], "]"}], "&"}], "/@", 
       "recPerBlock"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"alphaCutOffPosition", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Position", "[", 
        RowBox[{"alphaPerBlock", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", ">", "alphaCutOff"}], "&"}], ")"}]}], ",", "1", ",", 
         "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", " ", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "alphaCutOffPosition", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"alphaCutOffPosition", "=", 
         RowBox[{"First", "[", "alphaCutOffPosition", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"repeating", "=", 
         RowBox[{
          RowBox[{"Length", "[", "alphaPerBlock", "]"}], "-", 
          "alphaCutOffPosition", "+", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"alphaPerBlock", "=", 
         RowBox[{"alphaPerBlock", "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"alphaCutOffPosition", "-", "1"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"result", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"subsMutypeGFn", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "repeating"}], "}"}]}], "]"}]}], 
        ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"alphaCutOffPosition", "=", "0"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"CallInterpolation", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Ta", ",", " ", "#"}], "}"}], ",", "TwoParamInterpol"}], 
           "]"}], "&"}], "/@", "alphaPerBlock"}], ",", "result"}], "]"}]}], 
     ";", "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8115000497794237`*^9, 3.8115001234586363`*^9}, {
  3.811500643322233*^9, 3.81150066835343*^9}, {3.8115007129532747`*^9, 
  3.811500781056678*^9}, {3.81150786502075*^9, 3.811507907334797*^9}, {
  3.811508080977192*^9, 3.811508188841123*^9}, {3.811508250657379*^9, 
  3.811508253041572*^9}, {3.811508299074342*^9, 3.811508357529758*^9}, {
  3.8115089654755363`*^9, 3.8115089696874523`*^9}, {3.8115094985680447`*^9, 
  3.811509610661356*^9}, {3.811833194972439*^9, 3.8118333071220913`*^9}, {
  3.811833347698968*^9, 3.811833372770376*^9}, {3.811833565570898*^9, 
  3.811833570050201*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"7f9f1a47-8c68-462a-b996-f4a95cc63363"]
}, Closed]],

Cell[CellGroupData[{

Cell["Interpolation functions Yule", "Subsubsection",
 CellChangeTimes->{{3.810619022635428*^9, 3.810619034128487*^9}, {
  3.819007214465927*^9, 
  3.819007222896184*^9}},ExpressionUUID->"52e3b3d9-1a7a-4109-abce-\
4d09190b54e2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReturnInterpolationFunctionTable", "[", 
   RowBox[{
   "thetaAndNe_List", ",", " ", "ta_List", ",", " ", "s_List", ",", " ", 
    "recList_List", ",", " ", "GF_", ",", " ", "numSamples_", ",", " ", 
    "kmax_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Outer", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ReturnInterpolationFunctionYuleRec", "[", 
       RowBox[{
       "##", ",", "recList", ",", " ", "GF", ",", " ", "numSamples", ",", " ",
         "kmax"}], "]"}], "&"}], ",", "thetaAndNe", ",", "ta", ",", " ", "s", 
     ",", "1"}], "]"}], "//", "Parallelize"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.816586690522071*^9, 3.816586705432027*^9}, {
  3.816586755751752*^9, 3.816586844617111*^9}, {3.816588841495956*^9, 
  3.8165888452079887`*^9}, {3.816589976520149*^9, 3.816589981003972*^9}, {
  3.81659010740707*^9, 3.816590118300479*^9}, {3.816590180886499*^9, 
  3.816590184299335*^9}, {3.816590248766079*^9, 3.816590259751273*^9}, {
  3.8165903136222553`*^9, 3.8165903610357857`*^9}, {3.816590520430058*^9, 
  3.8165905220751057`*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"77e285ed-69c6-42d6-ba59-ee86fe9b173f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReturnInterpolationFunctionYuleRec", "[", 
   RowBox[{
   "thetaAndNe_", ",", " ", "ta_", ",", " ", "s_", ",", " ", "recList_List", 
    ",", " ", "GF_", ",", " ", "numSamples_", ",", " ", "kmax_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "PelnProbsPerRec", ",", "numProbsSingleThetaS", " ", ",", " ", 
      "customInterpolation", ",", " ", "mergeNumProbs", ",", " ", 
      RowBox[{"theta", "=", 
       RowBox[{"First", "[", "thetaAndNe", "]"}]}], ",", " ", 
      RowBox[{"Ne", "=", 
       RowBox[{"Last", "[", "thetaAndNe", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PelnProbsPerRec", "=", 
      RowBox[{"PreCalculateRandomVariablesYule", "[", 
       RowBox[{"Ne", ",", "s", ",", "numSamples", ",", "recList"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"numProbsSingleThetaS", "=", 
      RowBox[{"MakeAssListYulePrePelnThetaGF", "[", 
       RowBox[{
       "s", ",", "GF", ",", " ", "PelnProbsPerRec", ",", "recList", ",", "ta",
         ",", "numSamples", ",", " ", "theta", ",", "kmax"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mergeNumProbs", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "numProbsSingleThetaS", "]"}], ",", " ", 
        "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"customInterpolation", " ", "=", " ", 
        RowBox[{"Normal", "[", 
         RowBox[{"Interpolation", "/@", "mergeNumProbs"}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"customInterpolation", " ", "=", " ", 
      RowBox[{"Normal", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Interpolation", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Method", "->", "\"\<Hermite\>\""}]}], "]"}], "&"}], "/@", 
        "mergeNumProbs"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"SparseArray", "[", "customInterpolation", "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.816581764511314*^9, 3.816581803029257*^9}, {
  3.816581896073164*^9, 3.8165819692401123`*^9}, {3.816582922413225*^9, 
  3.8165829251193333`*^9}, {3.8165829657231417`*^9, 3.8165830497923183`*^9}, {
  3.816583115876873*^9, 3.8165831538963346`*^9}, {3.816583232472632*^9, 
  3.816583243025105*^9}, {3.816586728339794*^9, 3.816586747720257*^9}, {
  3.816588601033139*^9, 3.816588617471121*^9}, {3.816588693269279*^9, 
  3.81658869848663*^9}, {3.816589441703423*^9, 3.816589473878183*^9}, {
  3.8165897946812887`*^9, 3.816589797764666*^9}, {3.816589875695932*^9, 
  3.8165898827255573`*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"7d507767-0593-451c-9240-57d3be48e0f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakeAssListYulePrePelnThetaGF", "[", 
   RowBox[{
   "s_", ",", "GF_", ",", "PelnProbsPerRec_", ",", " ", "recForYule_", ",", 
    " ", "ta_", ",", " ", "numSamples_", ",", " ", "theta_", ",", " ", 
    "kmax_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "numProbs", ",", " ", "GFTa", ",", "GFPeln", ",", " ", "numProbsAss", 
      ",", " ", "AddSR", ",", " ", 
      RowBox[{"lineageTypes", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", "i", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"numSamples", "-", "1"}]}], "}"}]}], "]"}]}]}], "}"}], ",",
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GFTa", " ", "=", " ", 
      RowBox[{"BlockRules", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Ta", "\[Rule]", "ta"}], "}"}], ",", " ", "GF"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"GFPeln", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ReplacePelnGF", "[", 
         RowBox[{"#", ",", "GFTa"}], "]"}], "&"}], "/@", 
       "PelnProbsPerRec"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"numProbs", " ", "=", " ", 
      RowBox[{"MakeProbTable", "[", 
       RowBox[{
       "GFPeln", ",", "\[Omega]", ",", "theta", ",", "lineageTypes", ",", 
        "kmax"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"numProbsAss", " ", "=", " ", 
      RowBox[{"Association", "/@", 
       RowBox[{"ArrayRules", "/@", "numProbs"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AddSR", "[", 
       RowBox[{"r_", ",", "x_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"List", "[", 
         RowBox[{"r", ",", "#"}], "]"}], "&"}], "/@", "x"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"MapThread", "[", 
      RowBox[{"AddSR", ",", 
       RowBox[{"{", 
        RowBox[{"recForYule", ",", "numProbsAss"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8111578689004498`*^9, 3.8111580415556927`*^9}, {
   3.811481842612117*^9, 3.811481977819206*^9}, {3.811482071010984*^9, 
   3.811482071203054*^9}, {3.81330187053083*^9, 3.813301896000638*^9}, {
   3.813301945592621*^9, 3.813301958392767*^9}, {3.813303083397958*^9, 
   3.8133030899216537`*^9}, {3.813307173959206*^9, 3.813307268359088*^9}, {
   3.813338740736409*^9, 3.8133387458088493`*^9}, {3.8133387954158363`*^9, 
   3.813338887495552*^9}, {3.813338944112526*^9, 3.8133390223195267`*^9}, {
   3.813339169600412*^9, 3.8133392098312283`*^9}, {3.8133407576142063`*^9, 
   3.813340769213324*^9}, {3.8133408974842978`*^9, 3.813340898365367*^9}, {
   3.81334222010741*^9, 3.8133422945047007`*^9}, {3.813342340241889*^9, 
   3.813342340610257*^9}, {3.813342421570112*^9, 3.813342431090461*^9}, {
   3.813342463441577*^9, 3.8133424652019*^9}, {3.813344537558978*^9, 
   3.813344542006651*^9}, {3.8133446786149*^9, 3.813344679118195*^9}, {
   3.813382941179204*^9, 3.813383049090577*^9}, {3.813383115690736*^9, 
   3.813383118577919*^9}, {3.8133843517547398`*^9, 3.8133843518395452`*^9}, 
   3.8133855010754433`*^9, {3.8134724457875633`*^9, 3.813472604336594*^9}, {
   3.8134733905070953`*^9, 3.813473393490542*^9}, {3.816582838482648*^9, 
   3.816582842472528*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"804392bf-53c4-40b4-a2dd-f721d98f5df3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NumProbListSingle", "[", 
   RowBox[{
   "RecInterpol_", ",", "params_List", ",", " ", "recPerBlock_List", ",", 
    "mutypeGFn_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"theta", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", 
      RowBox[{"Ne", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
      RowBox[{"ta", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", 
      RowBox[{"s", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "alphaPerBlock", ",", " ", 
      RowBox[{"alphaCutOff", "=", "10"}], ",", " ", "alphaCutOffPosition", 
      ",", " ", "repeating", ",", " ", 
      RowBox[{"result", "=", 
       RowBox[{"{", "}"}]}], ",", " ", "subsMutypeGFn", ",", " ", 
      RowBox[{"newRecPerBlock", "=", "recPerBlock"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"subsMutypeGFn", "=", 
      RowBox[{"BlockRules", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Theta]", "\[Rule]", "theta"}], "}"}], ",", "mutypeGFn"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"s", "\[Equal]", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Table", "[", 
         RowBox[{"subsMutypeGFn", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "recPerBlock", "]"}]}], "}"}]}], "]"}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"alphaPerBlock", " ", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"alphaFroms", "[", 
         RowBox[{"s", ",", "#", ",", "N"}], "]"}], "&"}], "/@", 
       "recPerBlock"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"alphaCutOffPosition", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Position", "[", 
        RowBox[{"alphaPerBlock", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", ">", "alphaCutOff"}], "&"}], ")"}]}], ",", "1", ",", 
         "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", " ", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "alphaCutOffPosition", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"alphaCutOffPosition", "=", 
         RowBox[{"First", "[", "alphaCutOffPosition", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"repeating", "=", 
         RowBox[{
          RowBox[{"Length", "[", "alphaPerBlock", "]"}], "-", 
          "alphaCutOffPosition", "+", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"alphaPerBlock", "=", 
         RowBox[{"alphaPerBlock", "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"alphaCutOffPosition", "-", "1"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"result", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"subsMutypeGFn", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "repeating"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"newRecPerBlock", " ", "=", " ", 
         RowBox[{"newRecPerBlock", "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"alphaCutOffPosition", "-", "1"}]}], "]"}], "]"}]}]}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"alphaCutOffPosition", "=", "0"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"CallInterpolation", "[", 
           RowBox[{
            RowBox[{"{", "#", "}"}], ",", "RecInterpol"}], "]"}], "&"}], "/@",
          "newRecPerBlock"}], ",", "result"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8165844688220987`*^9, 3.816584488076268*^9}, {
  3.816584523789081*^9, 3.816584571244821*^9}, {3.8165850776362553`*^9, 
  3.8165851033408813`*^9}, {3.816585455117305*^9, 3.81658549499662*^9}, {
  3.8165875994191303`*^9, 3.816587601160348*^9}, {3.8165878464726686`*^9, 
  3.816587851464149*^9}, {3.8165879011227207`*^9, 3.816587902007536*^9}, {
  3.816588292127932*^9, 3.8165882958803377`*^9}, {3.816588337535473*^9, 
  3.81658843012807*^9}, {3.816591118334587*^9, 3.816591127370821*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"9286c4f6-58bc-4cc4-b516-280f60a5cb83"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakeNumProbTableYule", "[", 
   RowBox[{
   "RecInterpol_List", ",", " ", "paramTable_", ",", " ", "recPerBlock_List", 
    ",", " ", "mutypeGFn_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"depth", "=", "3"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"NumProbListSingle", "[", 
        RowBox[{"##", ",", "recPerBlock", ",", " ", "mutypeGFn"}], "]"}], 
       "&"}], ",", 
      RowBox[{"{", 
       RowBox[{"RecInterpol", ",", " ", "paramTable"}], "}"}], ",", "depth"}],
      "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.816584310197022*^9, 3.81658437514738*^9}, 
   3.8165844507076178`*^9, {3.8165844924208384`*^9, 3.8165845133013697`*^9}, 
   3.816585197445263*^9, {3.816585254620562*^9, 3.816585262651503*^9}, {
   3.816585505891737*^9, 3.816585505946095*^9}, {3.816585703867176*^9, 
   3.816585771227213*^9}, {3.8165881561782923`*^9, 3.816588206215149*^9}, {
   3.816588306294877*^9, 3.8165883251111107`*^9}, {3.816588460334715*^9, 
   3.816588501758951*^9}, {3.816590777077408*^9, 3.8165907876027527`*^9}, {
   3.8165928246898212`*^9, 3.816592860144535*^9}, {3.816592972841989*^9, 
   3.8165929768871403`*^9}, {3.816593047682487*^9, 3.816593047782984*^9}, {
   3.8165932617942047`*^9, 3.816593264639244*^9}, {3.816593295751144*^9, 
   3.816593295837089*^9}, {3.816593413608683*^9, 3.816593441542967*^9}, {
   3.816593477377782*^9, 3.816593492435156*^9}, {3.8165991543039837`*^9, 
   3.816599163919392*^9}, {3.8165993166532717`*^9, 3.81659932893393*^9}, {
   3.816599678356688*^9, 3.816599680316496*^9}, {3.816602978188037*^9, 
   3.8166029800579653`*^9}, 3.816603141033298*^9},
 CellLabel->"In[84]:=",ExpressionUUID->"663de2c7-8633-472b-83c1-ec37842d2447"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"to", " ", "run", " ", "MapThread", " ", "in", " ", "parallel"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"ParallelMap", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"ft", "[", 
      RowBox[{
       RowBox[{"Sequence", "@@", "##"}], ",", "1"}], "]"}], "&"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a1", ",", "a2", ",", "a3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"b1", ",", "b2", ",", "b3"}], "}"}]}], "}"}], "//", 
     "Transpose"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.816603931264867*^9, 
  3.8166039402768507`*^9}},ExpressionUUID->"53d89833-0787-4f83-9f75-\
73325f139768"]
}, Closed]],

Cell[CellGroupData[{

Cell["Calculate composite likelihood", "Subsubsection",
 CellChangeTimes->{{3.810372559885853*^9, 
  3.810372584495126*^9}},ExpressionUUID->"c0608fcc-ff32-4577-8ce3-\
d14c6d54756d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getLikelihood", "[", 
   RowBox[{
   "s_", ",", "N_", ",", " ", "theta_", ",", " ", "ta_", ",", " ", 
    "bsfs_List", ",", " ", "symbProb_", ",", " ", "recRate_", ",", " ", 
    "blockLength_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "recPerBlock", ",", " ", "alphaPerBlock", ",", "numProb", ",", " ", 
      "result"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"recPerBlock", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"recRate", "*", 
          RowBox[{"blockLength", "/", "2"}]}], "+", 
         RowBox[{"recRate", "*", "blockLength", "*", "i"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", 
          RowBox[{
           RowBox[{"Length", "[", "bsfs", "]"}], "-", "1"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"alphaPerBlock", " ", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"alphaFroms", "[", 
         RowBox[{"s", ",", "#", ",", "N"}], "]"}], "&"}], "/@", 
       "recPerBlock"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"numProb", "=", 
      RowBox[{"replaceValueInArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[Theta]", "\[Rule]", "theta"}], ",", " ", 
          RowBox[{"Ta", "\[Rule]", "ta"}]}], "}"}], ",", "alphaPerBlock", ",",
         " ", "symbProb"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"CalculateLikelihood", "[", 
       RowBox[{"bsfs", ",", " ", "numProb"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8103567637173634`*^9, 3.810356855922571*^9}, {
  3.810358598725884*^9, 3.810358777092238*^9}, {3.8103588148119307`*^9, 
  3.8103589448670397`*^9}, {3.810359963057229*^9, 3.810360003840575*^9}, {
  3.810360082216022*^9, 3.810360089864214*^9}, {3.81036015283976*^9, 
  3.8103602672270823`*^9}, {3.810366253988064*^9, 3.8103662894096203`*^9}, {
  3.810366320089917*^9, 3.81036634673929*^9}, {3.810385987691765*^9, 
  3.810386011313395*^9}, {3.8103987988272467`*^9, 3.810398831481812*^9}, {
  3.810399623975915*^9, 3.810399627813025*^9}, {3.810401307145452*^9, 
  3.810401322882285*^9}, {3.8104013767115993`*^9, 3.810401417158586*^9}, {
  3.810401452494719*^9, 3.8104015253804617`*^9}, {3.8104015616570787`*^9, 
  3.810401598566289*^9}, {3.8114962952065287`*^9, 3.81149629667202*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"173c971b-ba7f-4fc5-ad13-962c8bc9ee84"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "all", " ", "fixed", " ", "params", " ", "have", " ", "already", " ", 
     "been", " ", "substituted", " ", "in", " ", "the", " ", "equations"}], 
    ",", " ", 
    RowBox[{
    "only", " ", "variableParams", " ", "need", " ", "to", " ", "be", " ", 
     "passed"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"getLikelihoodWithInterpolation", "[", 
    RowBox[{
    "s_", ",", "N_", ",", " ", "bsfs_List", ",", " ", 
     "interpolatedProb_SparseArray", ",", " ", "recPerBlock_", ",", " ", 
     "dim_", ",", "NeutralSpAr_SparseArray", ",", 
     RowBox[{"theta_:", "False"}], ",", " ", 
     RowBox[{"ta_:", "False"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"alphaPerBlock", ",", "numProb", ",", " ", "result", ",", 
       RowBox[{"variableParams", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"theta", ",", " ", "ta"}], "}"}], ",", "False"}], "]"}]}], 
       ",", " ", "neutralProb", ",", 
       RowBox[{"alphaCutOff", "=", "12"}], ",", " ", "alphaCutOffPosition", 
       ",", 
       RowBox[{"neutralBlocks", "=", 
        RowBox[{"{", "}"}]}], ",", "newbsfs"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"alphaPerBlock", " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"alphaFroms", "[", 
          RowBox[{"s", ",", "#", ",", "N"}], "]"}], "&"}], "/@", 
        "recPerBlock"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "index", " ", "of", " ", "alphaPerBlock", " ", "from", " ", "which", 
         " ", "\[Alpha]"}], ">", "cutOff"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"alphaCutOffPosition", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"alphaPerBlock", ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", ">", "alphaCutOff"}], "&"}], ")"}]}], ",", "1", ",",
           "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "alphaCutOffPosition", "]"}], ">", "0"}], ",",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"alphaCutOffPosition", "=", 
          RowBox[{"First", "[", "alphaCutOffPosition", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"neutralBlocks", "=", 
          RowBox[{"bsfs", "[", 
           RowBox[{"[", 
            RowBox[{"alphaCutOffPosition", ";;"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"alphaPerBlock", "=", 
          RowBox[{"alphaPerBlock", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"alphaCutOffPosition", "-", "1"}]}], "]"}], "]"}]}], 
         ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"alphaCutOffPosition", "=", "0"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "alphaPerBlock", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"numProb", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"CallInterpolation", "[", 
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{"variableParams", ",", 
                RowBox[{"{", "#", "}"}]}], "]"}], ",", "interpolatedProb"}], 
             "]"}], "&"}], "/@", "alphaPerBlock"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "make", " ", "sure", " ", "list", " ", "of", " ", "parameters", " ",
            "passed", " ", "in", " ", "same", " ", "order", " ", "as", " ", 
           "for", " ", "interpolatedProb"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"result", "=", 
          RowBox[{
           RowBox[{"CalculateLikelihoodSerial", "[", 
            RowBox[{
             RowBox[{"bsfs", "[", 
              RowBox[{"[", 
               RowBox[{";;", 
                RowBox[{"alphaCutOffPosition", "-", "1"}]}], "]"}], "]"}], 
             ",", " ", "numProb"}], "]"}], "+", 
           RowBox[{"CalculateLikelihoodNeutralSerial", "[", 
            RowBox[{"neutralBlocks", ",", "NeutralSpAr"}], "]"}]}]}], ";"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"result", "=", 
          RowBox[{"CalculateLikelihoodNeutralSerial", "[", 
           RowBox[{"neutralBlocks", ",", "NeutralSpAr"}], "]"}]}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]",
     "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810488087976465*^9, 3.810488199077877*^9}, {
   3.8104885459015636`*^9, 3.8104885462541313`*^9}, {3.810488814254266*^9, 
   3.810488822092146*^9}, {3.8104888702859707`*^9, 3.8104888775096073`*^9}, {
   3.810488921358047*^9, 3.810488958069112*^9}, {3.8104889948694563`*^9, 
   3.810489046805997*^9}, {3.8104890790138407`*^9, 3.810489119458354*^9}, {
   3.810489451067885*^9, 3.810489583237121*^9}, {3.810489613390258*^9, 
   3.810489642077157*^9}, {3.810489695030143*^9, 3.8104897126776114`*^9}, {
   3.810489999987835*^9, 3.810490046504531*^9}, {3.8104903655490913`*^9, 
   3.810490396872654*^9}, {3.8105310464945383`*^9, 3.81053117818865*^9}, {
   3.810531551020227*^9, 3.810531552788494*^9}, {3.810533455647167*^9, 
   3.8105335074283333`*^9}, {3.810535331013733*^9, 3.810535332067586*^9}, {
   3.8105364035175533`*^9, 3.8105364093620567`*^9}, {3.810536461770495*^9, 
   3.810536489290701*^9}, {3.8105367749070673`*^9, 3.810536792802709*^9}, {
   3.810536863525391*^9, 3.8105368707105103`*^9}, {3.810538126638998*^9, 
   3.810538214042358*^9}, {3.810539805345932*^9, 3.810539808737523*^9}, {
   3.810539871561565*^9, 3.8105399301456127`*^9}, {3.810543008499234*^9, 
   3.8105430761678667`*^9}, {3.8105433523710938`*^9, 
   3.8105434022925158`*^9}, {3.810543503588398*^9, 3.810543505060945*^9}, {
   3.810544154465176*^9, 3.810544166088435*^9}, {3.8105442334191227`*^9, 
   3.810544408035614*^9}, {3.8105444604368267`*^9, 3.810544501085435*^9}, {
   3.810544846265951*^9, 3.81054485475821*^9}, {3.81054501762932*^9, 
   3.81054502885147*^9}, {3.8105451338712883`*^9, 3.810545141733954*^9}, {
   3.810545210476269*^9, 3.81054522034584*^9}, {3.810545275245854*^9, 
   3.810545275640209*^9}, {3.810545683738237*^9, 3.810545694664584*^9}, {
   3.8105457466126966`*^9, 3.8105457470460377`*^9}, {3.810546148179323*^9, 
   3.8105461816800213`*^9}, {3.8105463578198*^9, 3.810546358184451*^9}, {
   3.810548235615953*^9, 3.810548241127389*^9}, {3.810548567134128*^9, 
   3.8105485818206577`*^9}, {3.810548632166955*^9, 3.810548650314385*^9}, {
   3.8105488302037563`*^9, 3.810548855791922*^9}, {3.8105490109342337`*^9, 
   3.8105490240499067`*^9}, 3.810569214181601*^9, {3.8105692659128036`*^9, 
   3.810569269775086*^9}, {3.8105699851697397`*^9, 3.810570038114802*^9}, {
   3.81057009915399*^9, 3.810570104169512*^9}, {3.81057026599044*^9, 
   3.8105702728458157`*^9}, {3.810570645998659*^9, 3.810570678967519*^9}, {
   3.810570736318869*^9, 3.810570738884652*^9}, {3.810570864959826*^9, 
   3.810570865340172*^9}, {3.810571415160315*^9, 3.810571428395*^9}, {
   3.810571483448366*^9, 3.8105715177524757`*^9}, {3.8105715482007923`*^9, 
   3.8105715583291197`*^9}, {3.810571692326592*^9, 3.810571704083844*^9}, 
   3.8105724668703127`*^9, {3.8105726600364437`*^9, 3.810572670866374*^9}, 
   3.810573233341242*^9, {3.811487799651146*^9, 3.8114878335542107`*^9}, {
   3.8114878851780987`*^9, 3.8114879904650307`*^9}, {3.811488039406376*^9, 
   3.8114880429287252`*^9}, 3.811489317112105*^9, {3.811489671438273*^9, 
   3.8114897048539877`*^9}, {3.811489833026497*^9, 3.811489885037784*^9}, {
   3.811489964862562*^9, 3.811489973524053*^9}, {3.81149038351928*^9, 
   3.811490393468844*^9}, {3.811490448213303*^9, 3.811490535699912*^9}, {
   3.811490580013812*^9, 3.811490588355811*^9}, {3.811490705367292*^9, 
   3.811490708156233*^9}, {3.811490744382868*^9, 3.81149075455621*^9}, {
   3.8114910499167423`*^9, 3.811491056699637*^9}, {3.811491205806157*^9, 
   3.811491212707013*^9}, {3.8114912632213593`*^9, 3.811491263595158*^9}, {
   3.811491309758091*^9, 3.811491313475437*^9}, {3.811495069345553*^9, 
   3.811495091982923*^9}, {3.811495170570491*^9, 3.811495187774845*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"31351fd2-5644-463e-a015-c12b0dd00e4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CalculateLikelihood", "[", 
   RowBox[{"bsfs_List", ",", " ", "numProbList_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "pairwise", " ", "multiplication", " ", "of", " ", "elements", " ", "in",
       " ", "bsfs", " ", "and", " ", "numProbList"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Total", "[", 
     RowBox[{
      RowBox[{"MapThread", "[", 
       RowBox[{"totallnL", ",", 
        RowBox[{"{", 
         RowBox[{"bsfs", ",", " ", "numProbList"}], "}"}]}], "]"}], "//", 
      "Parallelize"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.81035535145225*^9, 3.810355425015245*^9}, {
   3.81035548551956*^9, 3.810355530030764*^9}, 3.8103555644715023`*^9, {
   3.810355679199214*^9, 3.8103556800864773`*^9}, {3.8103557407993937`*^9, 
   3.8103557475106573`*^9}, {3.8103665030986567`*^9, 
   3.8103665050732727`*^9}, {3.8103682269012537`*^9, 3.810368250563196*^9}, {
   3.810368320555533*^9, 3.810368325410757*^9}, {3.810368373872801*^9, 
   3.810368386682496*^9}, {3.810372822271928*^9, 3.810372828271618*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"15fe5355-c8d7-437a-a490-de3ede8e3a9a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CalculateLikelihoodNeutral", "[", 
   RowBox[{"bsfs_List", ",", " ", "numProb_SparseArray"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "bsfs", "]"}], "\[Equal]", "0"}], ",", "0", ",",
       "\[IndentingNewLine]", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"totallnL", "[", 
           RowBox[{"#", ",", " ", "numProb"}], "]"}], "&"}], "/@", "bsfs"}], "//",
         "Parallelize"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810539955354868*^9, 3.81054008703983*^9}, {
  3.8105462363867073`*^9, 3.810546245143833*^9}, {3.810546294339032*^9, 
  3.810546342881472*^9}, {3.81057272901947*^9, 3.8105727486230507`*^9}, {
  3.810572779165242*^9, 3.810572783522675*^9}, {3.810572876557323*^9, 
  3.810572908868167*^9}, {3.810573076008563*^9, 3.8105730963785057`*^9}, {
  3.81057312944188*^9, 3.810573188955944*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"4eb95909-8464-4f55-80a7-3090e31ed172"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CalculateLikelihoodSerial", "[", 
   RowBox[{"bsfs_List", ",", " ", "numProbList_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "pairwise", " ", "multiplication", " ", "of", " ", "elements", " ", "in",
       " ", "bsfs", " ", "and", " ", "numProbList"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Total", "[", 
     RowBox[{"MapThread", "[", 
      RowBox[{"totallnL", ",", 
       RowBox[{"{", 
        RowBox[{"bsfs", ",", " ", "numProbList"}], "}"}]}], "]"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.81035535145225*^9, 3.810355425015245*^9}, {
   3.81035548551956*^9, 3.810355530030764*^9}, 3.8103555644715023`*^9, {
   3.810355679199214*^9, 3.8103556800864773`*^9}, {3.8103557407993937`*^9, 
   3.8103557475106573`*^9}, {3.8103665030986567`*^9, 
   3.8103665050732727`*^9}, {3.8103682269012537`*^9, 3.810368250563196*^9}, {
   3.810368320555533*^9, 3.810368325410757*^9}, {3.810368373872801*^9, 
   3.810368386682496*^9}, {3.810372822271928*^9, 3.810372828271618*^9}, {
   3.81105575469392*^9, 3.811055758477754*^9}, 3.811090988191101*^9},
 CellLabel->"In[88]:=",ExpressionUUID->"b661a944-23ad-44ed-8f30-30349864b20c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CalculateLikelihoodNeutralSerial", "[", 
   RowBox[{"bsfs_List", ",", " ", "numProb_SparseArray"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "bsfs", "]"}], "\[Equal]", "0"}], ",", "0", ",",
       "\[IndentingNewLine]", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"totallnL", "[", 
          RowBox[{"#", ",", " ", "numProb"}], "]"}], "&"}], "/@", "bsfs"}], 
       "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810539955354868*^9, 3.81054008703983*^9}, {
   3.8105462363867073`*^9, 3.810546245143833*^9}, {3.810546294339032*^9, 
   3.810546342881472*^9}, {3.81057272901947*^9, 3.8105727486230507`*^9}, {
   3.810572779165242*^9, 3.810572783522675*^9}, {3.810572876557323*^9, 
   3.810572908868167*^9}, {3.810573076008563*^9, 3.8105730963785057`*^9}, {
   3.81057312944188*^9, 3.810573188955944*^9}, {3.811055762113392*^9, 
   3.811055765571546*^9}, {3.811057362977169*^9, 3.811057394123328*^9}, {
   3.8110653583559093`*^9, 3.81106535993773*^9}, {3.811090973352132*^9, 
   3.8110909741099577`*^9}, 3.81109101274918*^9, {3.811091343878757*^9, 
   3.8110913444373837`*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"39f534a2-ac76-4364-aeb0-bec5f9bff83e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"totallnL", "[", 
    RowBox[{"bsfs_SparseArray", ",", " ", "numProb_SparseArray"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "posn", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"posn", "=", 
       RowBox[{"numProb", "[", "\"\<NonzeroPositions\>\"", "]"}]}], ";", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"Log", "[", 
         RowBox[{"numProb", "[", "\"\<NonzeroValues\>\"", "]"}], "]"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Extract", "[", 
            RowBox[{"bsfs", ",", "#"}], "]"}], "&"}], "/@", "posn"}], ")"}]}],
        "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650784746197983*^9, 3.650784768430999*^9}, 
   3.65079958481174*^9, {3.650799646765745*^9, 3.650799650226345*^9}, {
   3.6508009807663107`*^9, 3.650800984192174*^9}, {3.650801845809001*^9, 
   3.650801847492399*^9}, {3.6508023804641523`*^9, 3.650802398207432*^9}, {
   3.650802560709681*^9, 3.65080256114811*^9}, {3.650802610103129*^9, 
   3.650802760628886*^9}, {3.650804670745363*^9, 3.650804718032611*^9}, {
   3.650804841846486*^9, 3.6508048445430107`*^9}, {3.65080492014219*^9, 
   3.650804921873021*^9}, {3.650872572955171*^9, 3.65087261028303*^9}, {
   3.651220331544826*^9, 3.651220331927487*^9}, {3.6512203653045683`*^9, 
   3.651220397695451*^9}, {3.651220433984274*^9, 3.651220438328389*^9}, {
   3.651220480304768*^9, 3.651220501647913*^9}, {3.810368273139056*^9, 
   3.8103683491384907`*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"1bbeead4-98aa-4264-8fef-9b7bae49a705"],

Cell[BoxData[
 RowBox[{
  RowBox[{"alphaFroms", "[", 
   RowBox[{"s_", ",", "r_", ",", "N_"}], "]"}], ":=", 
  RowBox[{
   FractionBox["r", "s"], "*", 
   RowBox[{"Log", "[", 
    RowBox[{"2", "*", "N", "*", "s"}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810358767048643*^9, 3.810358807302465*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"ee6f96c0-9d4f-453b-8df0-0ed7f597cfe8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"replaceValueInArray", "[", 
   RowBox[{"singleV_List", ",", " ", "mapV_List", ",", " ", "SpAr_"}], "]"}], 
  ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"symbProb", ",", " ", "tempr", ",", "\[IndentingNewLine]", 
      RowBox[{"dim", "=", 
       RowBox[{"Dimensions", "[", "SpAr", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"symbProb", "=", 
      RowBox[{"BlockRules", "[", 
       RowBox[{"singleV", ",", 
        RowBox[{"ArrayRules", "[", "SpAr", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tempr", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"BlockRules", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Alpha]", "\[Rule]", "#"}], "}"}], ",", "symbProb"}], 
          "]"}], "&"}], "/@", "mapV"}], "//", "Parallelize"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"SparseArray", "[", 
         RowBox[{"#", ",", " ", "dim"}], "]"}], "&"}], "/@", "tempr"}], " ", "//",
       "Parallelize"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810364404776424*^9, 3.810364473368651*^9}, {
  3.810364519024597*^9, 3.810364544757888*^9}, {3.810364592271964*^9, 
  3.8103645945814323`*^9}, {3.810364815872284*^9, 3.8103648397820807`*^9}, {
  3.8103648764531813`*^9, 3.810364882445459*^9}, {3.8103656986494427`*^9, 
  3.810365737738756*^9}, {3.810365861970339*^9, 3.8103659384103003`*^9}, {
  3.8103659998522367`*^9, 3.810366056473645*^9}, {3.810366490216136*^9, 
  3.8103664960822973`*^9}, {3.8103668247940483`*^9, 3.810366843451406*^9}, {
  3.810366874097456*^9, 3.810366892324597*^9}, {3.810367826885088*^9, 
  3.810367833036503*^9}, {3.810373523215095*^9, 3.810373529884912*^9}, {
  3.810449056567417*^9, 3.8104492809732237`*^9}, {3.810487250464373*^9, 
  3.8104872509025517`*^9}, {3.810615143409095*^9, 3.810615165312428*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"47327a09-dce1-4c0d-aaaf-d286340d71c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"BlockRules", ",", " ", "HoldRest"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlockRules", "[", 
   RowBox[{"rules_", ",", " ", "expr_"}], "]"}], ":=", 
  RowBox[{"Block", "@@", 
   RowBox[{"Append", "[", 
    RowBox[{
     RowBox[{"Apply", "[", 
      RowBox[{"Set", ",", 
       RowBox[{"Hold", "[", "rules", "]"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}], ",", 
     RowBox[{"Unevaluated", "[", "expr", "]"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"almost", " ", "as", " ", "fast", " ", "as", " ", 
    RowBox[{"blockrules", ":", " ", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Theta]", "=", "0.5"}], ",", " ", 
         RowBox[{"Ta", "=", "0.1"}], ",", " ", 
         RowBox[{"\[Alpha]", "=", "0.1"}]}], "}"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"ArrayRules", "[", "MutypeGF", "]"}], "]"}]}], "]"}]}]}], 
   "*)"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810447846378392*^9, 3.810447899501563*^9}, {
  3.810447931470849*^9, 3.81044793253421*^9}, {3.810447976749148*^9, 
  3.810447994646164*^9}, {3.810488526904381*^9, 3.810488527362001*^9}},
 CellLabel->"In[51]:=",ExpressionUUID->"42a42ff6-63ad-47d4-b232-42c0efad3158"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SparseArrayFromInterpolatedFunction", "[", 
   RowBox[{"interpolatedProb_List", ",", " ", "dim_", ",", "variables_List"}],
    "]"}], ":=", 
  RowBox[{"SparseArray", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"Sequence", "@@", "variables"}], "]"}]}], "&"}], "/@", 
     "interpolatedProb"}], ",", "dim"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810489197671708*^9, 3.810489297797279*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"007636db-878a-48e2-a450-3e3ab437dea3"]
}, Closed]],

Cell[CellGroupData[{

Cell["ProbArray for every other element", "Subsubsection",
 CellChangeTimes->{{3.81057508205869*^9, 
  3.810575102860154*^9}},ExpressionUUID->"ae00f0ba-36ee-4b05-8256-\
0de337b6f0d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getLikelihoodEveryOther", "[", 
   RowBox[{
   "s_", ",", "N_", ",", " ", "theta_", ",", " ", "ta_", ",", " ", 
    "bsfs_List", ",", " ", "symbProb_", ",", " ", "recRate_", ",", " ", 
    "blockLength_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "recPerBlock", ",", " ", "alphaPerBlock", ",", "numProb", ",", " ", 
      "result", ",", " ", "lastElement"}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{"recPerBlock", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"recRate", "*", 
          RowBox[{"blockLength", "/", "2"}]}], "+", 
         RowBox[{"recRate", "*", "blockLength", "*", "i"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", 
          RowBox[{"Length", "[", "bsfs", "]"}]}], "}"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{
      "add", " ", "one", " ", "r", " ", "value", " ", "to", " ", 
       "recPerBlockList", " ", "to", " ", "make", " ", "alphaPerBlock", " ", 
       "list", " ", "correct", " ", "length", " ", "in", " ", "final", " ", 
       "result"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"alphaPerBlock", " ", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"alphaFroms", "[", 
         RowBox[{"s", ",", "#", ",", "N"}], "]"}], "&"}], "/@", 
       "recPerBlock"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"alphaPerBlock", "=", 
      RowBox[{"alphaPerBlock", "[", 
       RowBox[{"[", 
        RowBox[{";;", ";;", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"numProb", "=", 
      RowBox[{"replaceValueInArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[Theta]", "\[Rule]", "theta"}], ",", " ", 
          RowBox[{"Ta", "\[Rule]", "ta"}]}], "}"}], ",", "alphaPerBlock", ",",
         " ", "symbProb"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"numProb", " ", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"BlockMap", "[", 
         RowBox[{"ReturnFirstAndMean", ",", "numProb", ",", "2", ",", "1"}], 
         "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"CalculateLikelihood", "[", 
       RowBox[{"bsfs", ",", " ", "numProb"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8103567637173634`*^9, 3.810356855922571*^9}, {
   3.810358598725884*^9, 3.810358777092238*^9}, {3.8103588148119307`*^9, 
   3.8103589448670397`*^9}, {3.810359963057229*^9, 3.810360003840575*^9}, {
   3.810360082216022*^9, 3.810360089864214*^9}, {3.81036015283976*^9, 
   3.8103602672270823`*^9}, {3.810366253988064*^9, 3.8103662894096203`*^9}, {
   3.810366320089917*^9, 3.81036634673929*^9}, {3.810385987691765*^9, 
   3.810386011313395*^9}, {3.8103987988272467`*^9, 3.810398831481812*^9}, {
   3.810399623975915*^9, 3.810399627813025*^9}, {3.810401307145452*^9, 
   3.810401322882285*^9}, {3.8104013767115993`*^9, 3.810401417158586*^9}, {
   3.810401452494719*^9, 3.8104015253804617`*^9}, {3.8104015616570787`*^9, 
   3.810401598566289*^9}, {3.8105751248072853`*^9, 3.81057519208673*^9}, {
   3.810614027200863*^9, 3.810614044190792*^9}, {3.810614080216958*^9, 
   3.810614103560273*^9}, {3.810614137464851*^9, 3.810614191865983*^9}, {
   3.810614235902903*^9, 3.8106142407543*^9}, {3.810614586071762*^9, 
   3.810614657436627*^9}, {3.810616235368721*^9, 3.8106162491366987`*^9}, 
   3.810616308793236*^9},
 CellLabel->"In[54]:=",ExpressionUUID->"7abb1694-ff80-43eb-af98-8d24b42db8a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReturnFirstAndMean", "[", "probs_List", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"probs", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
     RowBox[{"Mean", "[", "probs", "]"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.810614051671976*^9, 3.810614072310409*^9}, 
   3.8106148483415728`*^9},
 CellLabel->"In[55]:=",ExpressionUUID->"dff60501-09ca-4a12-b9e4-11ded3fde02b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Gridded Inference", "Subsubsection",
 CellChangeTimes->{{3.817486549429241*^9, 
  3.817486553912744*^9}},ExpressionUUID->"dcdcbc38-d134-49d0-8b02-\
b752accd2e55"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MaximizeAcrossGrid", "[", 
   RowBox[{
   "paramTable_List", ",", " ", "grid_List", ",", " ", "startingPoint_List", 
    ",", " ", "file_", ",", " ", "n_", ",", " ", "kmax_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "CurrentPosValue", ",", "CurrentPos", ",", "intermediateResult", ",", 
      " ", 
      RowBox[{"count", "=", "0"}], ",", 
      RowBox[{"dims", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", "paramTable", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "2"}]}], "]"}], "]"}]}], ",", " ", "numberPoints", ",",
       " ", "bsfs"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bsfs", "=", 
      RowBox[{"ImportDataCutOff", "[", 
       RowBox[{"file", ",", "n", ",", "kmax", ",", "False", ",", "10000"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"numberPoints", "=", 
      RowBox[{"Times", "@@", "dims"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"CurrentPos", "=", 
      RowBox[{"First", "[", 
       RowBox[{"Position", "[", 
        RowBox[{"paramTable", ",", " ", "startingPoint"}], "]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"CurrentPosValue", "=", 
      RowBox[{"CalculateLikelihoodSerial", "[", 
       RowBox[{"bsfs", ",", " ", 
        RowBox[{"Extract", "[", 
         RowBox[{"grid", ",", " ", "CurrentPos"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "startValue", "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"intermediateResult", "=", 
      RowBox[{"CalculateCLForNeighbors", "[", 
       RowBox[{
       "grid", ",", " ", "bsfs", ",", " ", "CurrentPos", ",", " ", "dims"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "intermediateResult", "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CurrentPosValue", "<", 
         RowBox[{"Last", "[", "intermediateResult", "]"}]}], " ", "&&", " ", 
        RowBox[{"count", "\[LessEqual]", " ", "numberPoints"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CurrentPosValue", "=", 
         RowBox[{"Last", "[", "intermediateResult", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"CurrentPos", "=", 
         RowBox[{"First", "[", "intermediateResult", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"intermediateResult", "=", 
         RowBox[{"CalculateCLForNeighbors", "[", 
          RowBox[{"grid", ",", " ", "bsfs", ",", " ", 
           RowBox[{"First", "[", "intermediateResult", "]"}], ",", " ", 
           "dims"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "intermediateResult", "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"count", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Extract", "[", 
         RowBox[{"paramTable", ",", "CurrentPos"}], "]"}], ",", 
        "CurrentPosValue"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811766096840049*^9, 3.811766144107831*^9}, {
   3.8117662059467297`*^9, 3.811766223722746*^9}, {3.811766315074937*^9, 
   3.811766433554867*^9}, {3.811766499057094*^9, 3.811766720682106*^9}, {
   3.811766752889985*^9, 3.8117667722668867`*^9}, {3.81176718061901*^9, 
   3.811767207609988*^9}, {3.8117787949313917`*^9, 3.8117788055076838`*^9}, {
   3.8117788959814463`*^9, 3.811778982253448*^9}, {3.811779815516168*^9, 
   3.811779858274312*^9}, {3.811780349834935*^9, 3.811780371859174*^9}, {
   3.811782115185443*^9, 3.811782121000163*^9}, {3.811782307369575*^9, 
   3.811782312511134*^9}, {3.8117823486972713`*^9, 3.8117823499022217`*^9}, {
   3.811782397560583*^9, 3.811782422543273*^9}, {3.811782561880951*^9, 
   3.811782589594599*^9}, {3.811783219792898*^9, 3.811783231326782*^9}, {
   3.811784327741507*^9, 3.8117843946614*^9}, {3.811826760817253*^9, 
   3.811826770550212*^9}, 3.8118268159037447`*^9, {3.8118275470022697`*^9, 
   3.8118275693524714`*^9}, {3.811828015880662*^9, 3.811828019803735*^9}, {
   3.811828050360828*^9, 3.811828058644362*^9}, {3.811828383441428*^9, 
   3.811828520807424*^9}, 3.8118285569621696`*^9, {3.812823524334214*^9, 
   3.8128235292314587`*^9}, {3.819004990881278*^9, 3.819004991639081*^9}, {
   3.8190050648148527`*^9, 
   3.819005066370495*^9}},ExpressionUUID->"32aefa05-ef19-4db6-9a7d-\
3340b5a1f93e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MaximizeAcrossGridComposite", "[", 
   RowBox[{
   "paramTable_List", ",", " ", "grid_List", ",", " ", "startingPoint_List", 
    ",", " ", "file_", ",", " ", "n_", ",", " ", "kmax_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "CurrentPosValue", ",", "CurrentPos", ",", "intermediateResult", ",", 
      " ", 
      RowBox[{"count", "=", "0"}], ",", 
      RowBox[{"dims", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", "paramTable", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "2"}]}], "]"}], "]"}]}], ",", " ", "numberPoints", ",",
       " ", "bsfs"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bsfs", "=", 
      RowBox[{"ImportDataCutOffComposite", "[", 
       RowBox[{"file", ",", "n", ",", "kmax", ",", "10000"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"numberPoints", "=", 
      RowBox[{"Times", "@@", "dims"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"CurrentPos", "=", 
      RowBox[{"First", "[", 
       RowBox[{"Position", "[", 
        RowBox[{"paramTable", ",", " ", "startingPoint"}], "]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"CurrentPosValue", "=", 
      RowBox[{"CalculateLikelihoodSerial", "[", 
       RowBox[{"bsfs", ",", " ", 
        RowBox[{"Extract", "[", 
         RowBox[{"grid", ",", " ", "CurrentPos"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "startValue", "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"intermediateResult", "=", 
      RowBox[{"CalculateCLForNeighbors", "[", 
       RowBox[{
       "grid", ",", " ", "bsfs", ",", " ", "CurrentPos", ",", " ", "dims"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "intermediateResult", "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CurrentPosValue", "<", 
         RowBox[{"Last", "[", "intermediateResult", "]"}]}], " ", "&&", " ", 
        RowBox[{"count", "\[LessEqual]", " ", "numberPoints"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CurrentPosValue", "=", 
         RowBox[{"Last", "[", "intermediateResult", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"CurrentPos", "=", 
         RowBox[{"First", "[", "intermediateResult", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"intermediateResult", "=", 
         RowBox[{"CalculateCLForNeighbors", "[", 
          RowBox[{"grid", ",", " ", "bsfs", ",", " ", 
           RowBox[{"First", "[", "intermediateResult", "]"}], ",", " ", 
           "dims"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "intermediateResult", "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"count", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Extract", "[", 
         RowBox[{"paramTable", ",", "CurrentPos"}], "]"}], ",", 
        "CurrentPosValue", ",", " ", "count"}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811766096840049*^9, 3.811766144107831*^9}, {
   3.8117662059467297`*^9, 3.811766223722746*^9}, {3.811766315074937*^9, 
   3.811766433554867*^9}, {3.811766499057094*^9, 3.811766720682106*^9}, {
   3.811766752889985*^9, 3.8117667722668867`*^9}, {3.81176718061901*^9, 
   3.811767207609988*^9}, {3.8117787949313917`*^9, 3.8117788055076838`*^9}, {
   3.8117788959814463`*^9, 3.811778982253448*^9}, {3.811779815516168*^9, 
   3.811779858274312*^9}, {3.811780349834935*^9, 3.811780371859174*^9}, {
   3.811782115185443*^9, 3.811782121000163*^9}, {3.811782307369575*^9, 
   3.811782312511134*^9}, {3.8117823486972713`*^9, 3.8117823499022217`*^9}, {
   3.811782397560583*^9, 3.811782422543273*^9}, {3.811782561880951*^9, 
   3.811782589594599*^9}, {3.811783219792898*^9, 3.811783231326782*^9}, {
   3.811784327741507*^9, 3.8117843946614*^9}, {3.811826760817253*^9, 
   3.811826770550212*^9}, 3.8118268159037447`*^9, {3.8118275470022697`*^9, 
   3.8118275693524714`*^9}, {3.811828015880662*^9, 3.811828019803735*^9}, {
   3.811828050360828*^9, 3.811828058644362*^9}, {3.811828383441428*^9, 
   3.811828520807424*^9}, 3.8118285569621696`*^9, {3.812823524334214*^9, 
   3.8128235292314587`*^9}, {3.8142024315135193`*^9, 
   3.8142024327922707`*^9}, {3.814202540872921*^9, 3.8142025654446573`*^9}, {
   3.814203958152841*^9, 3.814203959102285*^9}, {3.8190049983844748`*^9, 
   3.819004999442878*^9}, {3.819005057902244*^9, 
   3.819005059866364*^9}},ExpressionUUID->"7e65f759-25d9-4680-be2a-\
0021d620e4fc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NearestNeighbors", "[", 
   RowBox[{"Position_List", ",", " ", "dims_List"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"newPositions", ",", " ", "zeroBasedPos"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"zeroBasedPos", "=", 
      RowBox[{"Position", "-", "1"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newPositions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"zeroBasedPos", "+", "#"}], "&"}], "/@", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Permutations", "[", 
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"{", "1", "}"}], ",", 
            RowBox[{"Length", "[", "dims", "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"Permutations", "[", 
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"-", "1"}], "}"}], ",", 
            RowBox[{"Length", "[", "dims", "]"}]}], "]"}], "]"}]}], "]"}]}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"newPositions", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"zeroBasedPos", "+", "#"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"newPositions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Mod", "[", 
         RowBox[{"#", ",", "dims"}], "]"}], "&"}], "/@", "newPositions"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"newPositions", "+", "1"}], "]"}], ",", "Position"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811759085627294*^9, 3.811759148260047*^9}, {
   3.811762221718862*^9, 3.811762225272852*^9}, {3.8117623828334637`*^9, 
   3.8117624111672087`*^9}, {3.811762512423888*^9, 3.811762519823791*^9}, {
   3.811762602983906*^9, 3.811762603135785*^9}, {3.811762657274836*^9, 
   3.811762663318789*^9}, {3.811762697578156*^9, 3.811762779719901*^9}, {
   3.811762842178441*^9, 3.811762848063078*^9}, {3.811763038584077*^9, 
   3.8117630542476397`*^9}, {3.811763134681691*^9, 3.811763213417449*^9}, {
   3.811763245056101*^9, 3.8117632701674223`*^9}, 3.811780810227923*^9, {
   3.811783076943387*^9, 3.811783141873743*^9}, {3.811785937933941*^9, 
   3.811785993955019*^9}, {3.811828598111164*^9, 3.8118286015583563`*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"6224da8a-288c-4c56-88b0-fe06c222302c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "needs", " ", "to", " ", "return", " ", "position", " ", "and", " ", 
    "associated", " ", "lnCL"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CalculateCLForNeighbors", "[", 
    RowBox[{
    "grid_List", ",", "bsfs_List", ",", " ", "Position_List", ",", " ", 
     "dims_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "neighbors", ",", " ", "numProbs", ",", " ", "result", ",", " ", 
       "maxValuePos"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"neighbors", "=", 
       RowBox[{"NearestNeighbors", "[", 
        RowBox[{"Position", ",", " ", "dims"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numProbs", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"grid", ",", " ", "neighbors"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"result", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"CalculateLikelihoodSerial", "[", 
          RowBox[{"bsfs", ",", " ", "#"}], "]"}], "&"}], "/@", "numProbs"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"maxValuePos", "=", 
       RowBox[{"Ordering", "[", 
        RowBox[{"result", ",", 
         RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Extract", "[", 
          RowBox[{"neighbors", ",", "maxValuePos"}], "]"}], ",", 
         RowBox[{"Extract", "[", 
          RowBox[{"result", ",", " ", "maxValuePos"}], "]"}]}], "}"}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811762621605084*^9, 3.811762622951792*^9}, {
  3.811763704526752*^9, 3.8117637147329073`*^9}, {3.811763835756446*^9, 
  3.811764037709832*^9}, {3.811764245966107*^9, 3.8117645093062677`*^9}, {
  3.8117645842934227`*^9, 3.81176458491846*^9}, {3.811764696613792*^9, 
  3.811764767899321*^9}, {3.811766235770514*^9, 3.81176629845858*^9}, {
  3.811778828723126*^9, 3.811778849611166*^9}, {3.8117797925389214`*^9, 
  3.811779801341692*^9}, {3.811780417408929*^9, 3.811780464801038*^9}, {
  3.811780910043051*^9, 3.81178091440137*^9}, {3.811782074779504*^9, 
  3.811782080834838*^9}, {3.811826786458623*^9, 3.811826802849305*^9}, {
  3.81182855056166*^9, 3.811828551066267*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"57c91f79-a9a3-4830-9f60-fb114bb341e7"]
}, Closed]],

Cell[CellGroupData[{

Cell["Estimate Theta", "Subsubsection",
 CellChangeTimes->{{3.8190063454239807`*^9, 
  3.819006348366561*^9}},ExpressionUUID->"41c1f597-5955-41d7-aa71-\
4b72a2c2e9ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ImportDataForTheta", "[", 
   RowBox[{
   "dfName_", ",", " ", "n_", ",", " ", "kmax_", ",", " ", "cutOff_"}], "]"}],
   ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"raw", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", "dfName", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "2"}]}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"cutOff", ";;"}], "]"}], "]"}]}], ",", " ", "results"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"results", "=", 
     RowBox[{"Total", "[", 
      RowBox[{"MakeAllbSFS", "[", 
       RowBox[{"raw", ",", "kmax", ",", 
        RowBox[{"n", "-", "1"}], ",", "False"}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.812561783378252*^9, 3.81256185959132*^9}, {
  3.812561962712315*^9, 3.812562004336657*^9}, {3.8125621838026876`*^9, 
  3.8125622070364523`*^9}, {3.812562245946607*^9, 3.812562250615961*^9}, {
  3.81418850289785*^9, 
  3.814188503428705*^9}},ExpressionUUID->"6bbcfe22-5e4f-44f6-8be1-\
a41a794b2e20"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ImportDataForThetaComposite", "[", 
   RowBox[{
   "dfName_", ",", " ", "n_", ",", " ", "kmax_", ",", " ", "cutOff_"}], "]"}],
   ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"raw", "=", 
       RowBox[{"Import", "[", "dfName", "]"}]}], ",", " ", "results", ",", 
      " ", "blockAss"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"blockAss", " ", "=", " ", 
      RowBox[{
       RowBox[{"KeySort", "[", 
        RowBox[{"GroupBy", "[", 
         RowBox[{"raw", ",", " ", "First"}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"cutOff", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"results", " ", "=", " ", 
      RowBox[{"Total", "[", 
       RowBox[{"Values", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MakebSFS", "[", 
           RowBox[{"#", ",", "kmax", ",", " ", 
            RowBox[{"n", "-", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@", 
         "blockAss"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "results"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.812561783378252*^9, 3.81256185959132*^9}, {
   3.812561962712315*^9, 3.812562004336657*^9}, {3.8125621838026876`*^9, 
   3.8125622070364523`*^9}, {3.812562245946607*^9, 3.812562250615961*^9}, {
   3.814188433649219*^9, 3.814188437702938*^9}, {3.814188487024005*^9, 
   3.8141885861911507`*^9}, 3.814188811437316*^9, {3.8141898962214813`*^9, 
   3.814189902618191*^9}},
 CellLabel->
  "In[180]:=",ExpressionUUID->"ff21b21f-f00e-47b4-9533-41756f295ed1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OptimizeTheta", "[", 
   RowBox[{
   "data_SparseArray", ",", " ", "MutypeGFn_SparseArray", ",", " ", 
    "theta_"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "numProbs", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"numProbs", "=", 
      RowBox[{"BlockRules", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Theta]", "\[Rule]", "theta"}], "}"}], ",", " ", 
        "MutypeGFn"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"totallnL", "[", 
      RowBox[{"data", ",", " ", "numProbs"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.812429099686603*^9, 3.812429200037644*^9}, {
  3.812429249420765*^9, 3.812429283315516*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"a64d9f9b-5c56-48e0-95a6-2a0b2ba3a322"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OptimizeAll", "[", 
   RowBox[{
   "file_", ",", " ", "MutypeGFn_SparseArray", ",", " ", "numSamples_", ",", 
    "kmax_", ",", "cutOff_"}], " ", "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "bsfs", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bsfs", "=", 
      RowBox[{"ImportDataForTheta", "[", 
       RowBox[{
       "file", ",", " ", "numSamples", ",", " ", "kmax", ",", " ", "cutOff"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NMaximize", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"OptimizeTheta", "[", 
          RowBox[{"bsfs", ",", "MutypeGFn", ",", "theta"}], "]"}], ",", 
         RowBox[{"0.3", "<", "theta", "<", "0.7"}]}], "}"}], ",", 
       RowBox[{"{", "theta", "}"}], ",", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", "\"\<NelderMead\>\"", "}"}]}], ",", 
       RowBox[{"MaxIterations", "\[Rule]", "100"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.812430084683978*^9, 3.812430181496861*^9}, {
  3.8124308523388777`*^9, 3.812430875005163*^9}, {3.812458196411018*^9, 
  3.8124582046810226`*^9}, {3.819006975280746*^9, 
  3.819006980962757*^9}},ExpressionUUID->"2f7f2ce8-2acd-48c5-869d-\
88283190d727"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OptimizeAllComposite", "[", 
   RowBox[{
   "file_", ",", " ", "MutypeGFn_SparseArray", ",", " ", "numSamples_", ",", 
    "kmax_", ",", "cutOff_"}], " ", "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "bsfs", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bsfs", "=", 
      RowBox[{"ImportDataForThetaComposite", "[", 
       RowBox[{
       "file", ",", " ", "numSamples", ",", " ", "kmax", ",", " ", "cutOff"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NMaximize", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"OptimizeTheta", "[", 
          RowBox[{"bsfs", ",", "MutypeGFn", ",", "theta"}], "]"}], ",", 
         RowBox[{"0.3", "<", "theta", "<", "0.7"}]}], "}"}], ",", 
       RowBox[{"{", "theta", "}"}], ",", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", "\"\<NelderMead\>\"", "}"}]}], ",", 
       RowBox[{"MaxIterations", "\[Rule]", "100"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.812430084683978*^9, 3.812430181496861*^9}, {
  3.8124308523388777`*^9, 3.812430875005163*^9}, {3.812458196411018*^9, 
  3.8124582046810226`*^9}, {3.813950865384321*^9, 3.813950883694131*^9}, {
  3.819006985441175*^9, 
  3.819006991138771*^9}},ExpressionUUID->"22e0d828-df15-4e57-88da-\
3dc1d7fe2f6b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Auxiliary functions", "Subsubsection",
 CellChangeTimes->{{3.819004770185651*^9, 
  3.819004789884594*^9}},ExpressionUUID->"21376b50-8248-4d7a-9f7e-\
1be4fefff048"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RoundAdapted", "[", "InputValue_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"InputValue", "\[LessEqual]", " ", "0.4"}], ",", " ", "0.4", ",",
      " ", 
     RowBox[{"Round", "[", 
      RowBox[{"InputValue", ",", " ", "0.05"}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8127190278863897`*^9, 3.812719095995332*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"5a0cc77a-1529-4e6c-ab46-1c2d71fe8d0a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReturnPosition", "[", 
    RowBox[{"InputValue_", ",", " ", "thetaList_"}], "]"}], ":=", 
   RowBox[{"First", "[", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Position", "[", 
      RowBox[{"thetaList", ",", 
       RowBox[{"RoundAdapted", "[", "InputValue", "]"}]}], "]"}], "]"}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.812732973337091*^9, 3.812733050430307*^9}, {
  3.81273309502485*^9, 3.812733113574321*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"9586ab1f-c67d-4a83-877b-b7e55d73f22d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"extractString", "[", "s_String", "]"}], ":=", 
  RowBox[{"FromDigits", "[", 
   RowBox[{"Map", "[", 
    RowBox[{"FromDigits", ",", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{"Characters", "[", "s", "]"}], ",", "DigitQ"}], "]"}]}], "]"}],
    "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.814080821252846*^9, 3.8140808322842283`*^9}, {
  3.814080885320775*^9, 3.814080886841557*^9}, {3.8140810676781054`*^9, 
  3.814081087584443*^9}, {3.814081166493477*^9, 3.814081186260746*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"887a003c-9321-40cb-aa8b-2d2e46292efe"]
}, Closed]],

Cell[CellGroupData[{

Cell["ROC curve functions", "Subsubsection",
 CellChangeTimes->{{3.819021786785637*^9, 
  3.8190218077179947`*^9}},ExpressionUUID->"b29fcca5-aa5f-4323-8c44-\
23977d017a71"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"returns", " ", "list", " ", "of", " ", "True", " ", 
     RowBox[{"(", "selection", ")"}], " ", "and", " ", "False", " ", 
     RowBox[{"(", "neutral", ")"}]}], ",", " ", 
    RowBox[{
    "perfect", " ", "classifier", " ", "has", " ", "all", " ", "True", " ", 
     "values", " ", "first"}], ",", " ", 
    RowBox[{"then", " ", "all", " ", "False"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MakeSortedClassificationList", "[", 
    RowBox[{"Positives_", ",", " ", "Negatives_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "selectionListRules", ",", " ", "neutralListRules", ",", " ", 
       "classifierAssociation"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"selectionListRules", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", "True"}], "&"}], "/@", "Positives"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"neutralListRules", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", "False"}], "&"}], "/@", "Negatives"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"classifierAssociation", " ", "=", " ", 
       RowBox[{"Association", "[", 
        RowBox[{"Join", "[", 
         RowBox[{"selectionListRules", ",", "neutralListRules"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Values", "[", 
       RowBox[{"Reverse", "[", 
        RowBox[{"KeySort", "[", "classifierAssociation", "]"}], "]"}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811066219604314*^9, 3.811066358317171*^9}, {
  3.8111433542923307`*^9, 3.811143552825877*^9}, {3.8111467247540092`*^9, 
  3.811146761528039*^9}, {3.811146864825554*^9, 3.811146871083787*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"bd9801bf-2808-45a1-a2ec-3c32b2f38df3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"returns", " ", "list", " ", "of", " ", "True", " ", 
     RowBox[{"(", "selection", ")"}], " ", "and", " ", "False", " ", 
     RowBox[{"(", "neutral", ")"}]}], ",", " ", 
    RowBox[{
    "perfect", " ", "classifier", " ", "has", " ", "all", " ", "True", " ", 
     "values", " ", "first"}], ",", " ", 
    RowBox[{"then", " ", "all", " ", "False"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MakeSortedClassificationListAss", "[", 
    RowBox[{"Positives_", ",", " ", "Negatives_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "selectionListRules", ",", " ", "neutralListRules", ",", " ", 
       "classifierAssociation"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"selectionListRules", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", "True"}], "&"}], "/@", "Positives"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"neutralListRules", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", "False"}], "&"}], "/@", "Negatives"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"classifierAssociation", " ", "=", " ", 
       RowBox[{"Association", "[", 
        RowBox[{"Join", "[", 
         RowBox[{"selectionListRules", ",", "neutralListRules"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Reverse", "[", 
       RowBox[{"KeySort", "[", "classifierAssociation", "]"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811066219604314*^9, 3.811066358317171*^9}, {
  3.8111433542923307`*^9, 3.811143552825877*^9}, {3.8111467247540092`*^9, 
  3.811146761528039*^9}, {3.811146864825554*^9, 3.811146871083787*^9}, {
  3.816330327935095*^9, 3.8163303384938*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"4a6a672d-8911-43ee-8619-a810232322d8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReturnRocValues", "[", "classificationList_List", "]"}], ":=", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"List", "[", 
      RowBox[{
       RowBox[{"FPR", "[", 
        RowBox[{
         RowBox[{"classificationList", "[", 
          RowBox[{"[", 
           RowBox[{";;", "i"}], "]"}], "]"}], ",", 
         RowBox[{"classificationList", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"TPR", "[", 
        RowBox[{
         RowBox[{"classificationList", "[", 
          RowBox[{"[", 
           RowBox[{";;", "i"}], "]"}], "]"}], ",", 
         RowBox[{"classificationList", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}]}], "]"}]}], "]"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{
        RowBox[{"Length", "[", "classificationList", "]"}], "-", "1"}]}], 
      "}"}]}], "]"}], "//", "Parallelize"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811143569560465*^9, 3.811143609993396*^9}, {
  3.81114619518253*^9, 3.811146391756473*^9}, {3.811146557409033*^9, 
  3.811146557489428*^9}, {3.811146595591743*^9, 3.811146598928323*^9}, {
  3.8111474175357857`*^9, 3.811147438621697*^9}, {3.811147569677249*^9, 
  3.811147759752022*^9}, {3.811148008772307*^9, 3.811148013835092*^9}, {
  3.811148308660676*^9, 3.811148385466865*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"6748f971-35c3-4107-aaf2-a65179a7c4a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TPR", "[", 
   RowBox[{"Positives_", ",", " ", "Negatives_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"TP", ",", " ", "FN"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TP", "=", 
      RowBox[{"Count", "[", 
       RowBox[{"Positives", ",", "True"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"FN", "=", 
      RowBox[{"Count", "[", 
       RowBox[{"Negatives", ",", " ", "True"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"TP", "/", 
      RowBox[{"(", 
       RowBox[{"TP", "+", "FN"}], ")"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.811143657664215*^9, 3.8111437580578012`*^9}, {
  3.811143872241048*^9, 3.811143904824604*^9}, {3.811147907109838*^9, 
  3.811147909506217*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"d24eaa4f-4004-49f9-a054-76db1003593e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FPR", "[", 
   RowBox[{"Positives_", ",", " ", "Negatives_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"FP", ",", " ", "TN"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"FP", "=", 
      RowBox[{"Count", "[", 
       RowBox[{"Positives", ",", "False"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"TN", "=", 
      RowBox[{"Count", "[", 
       RowBox[{"Negatives", ",", " ", "False"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"FP", "/", 
      RowBox[{"(", 
       RowBox[{"TN", "+", "FP"}], ")"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.81114391662362*^9, 3.811143950223387*^9}, {
  3.811147898806229*^9, 3.811147903258363*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"77d4cbd5-7922-48ef-87a1-a7430437cdf1"]
}, Closed]]
},
WindowSize->{960, 1035},
WindowMargins->{{-1920, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.0 for Mac OS X x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 172, 3, 45, "Subsubsection",ExpressionUUID->"a33df38d-9333-43b9-abf6-230373cf0d27"],
Cell[755, 27, 2300, 48, 194, "Input",ExpressionUUID->"81377c29-242e-46dd-8e87-a70ab8d91a7c",
 InitializationCell->True],
Cell[3058, 77, 1594, 36, 152, "Input",ExpressionUUID->"f08eb01c-ef12-47b9-b3d0-8c67d0c74659",
 InitializationCell->True],
Cell[4655, 115, 1826, 41, 152, "Input",ExpressionUUID->"cbf78fba-6639-41f5-908c-5d6354460427",
 InitializationCell->True],
Cell[6484, 158, 1862, 43, 173, "Input",ExpressionUUID->"937d61c2-396a-4f1a-9ed1-8f5bc76f5412",
 InitializationCell->True],
Cell[8349, 203, 2084, 48, 194, "Input",ExpressionUUID->"105bab04-803c-42d9-88d8-abc67a5ef6f6",
 InitializationCell->True],
Cell[10436, 253, 3346, 69, 173, "Input",ExpressionUUID->"38094386-f324-44c9-b107-a74f40e12e31",
 InitializationCell->True],
Cell[13785, 324, 240, 6, 46, "Input",ExpressionUUID->"e1a523fd-ef95-4872-82f0-e3a24d785420",
 InitializationCell->True,
 InitializationGroup->True],
Cell[14028, 332, 1772, 41, 152, "Input",ExpressionUUID->"959b1860-616a-4bc9-a101-0a1d3c8af064",
 InitializationCell->True],
Cell[15803, 375, 438, 10, 46, "Input",ExpressionUUID->"3a9a5e39-ffa6-4033-8988-02488f233115",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[16278, 390, 214, 4, 37, "Subsubsection",ExpressionUUID->"2cd2e925-1efd-426f-811a-48f401800045"],
Cell[16495, 396, 2139, 32, 265, "Input",ExpressionUUID->"e1a3be73-336e-4229-adae-3e13c2f55ac0",
 InitializationCell->True],
Cell[18637, 430, 1486, 24, 89, "Input",ExpressionUUID->"3fd339ab-3107-442a-85ae-bf336b45cc6c",
 InitializationCell->True],
Cell[20126, 456, 1279, 21, 46, "Input",ExpressionUUID->"62d20b6c-a3a2-4b24-b62c-0faf438c0552",
 InitializationCell->True],
Cell[21408, 479, 1368, 21, 68, "Input",ExpressionUUID->"675ea000-5b7d-4137-a160-12b7149d09e4",
 InitializationCell->True],
Cell[22779, 502, 1486, 23, 89, "Input",ExpressionUUID->"3f5354ff-9eb7-4fdf-b96e-ebdbf422ccbb",
 InitializationCell->True],
Cell[24268, 527, 8022, 170, 362, "Input",ExpressionUUID->"d7df8e7b-8083-4568-a9f7-d0aa3bd4f51e",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[32327, 702, 167, 3, 37, "Subsubsection",ExpressionUUID->"51375c3c-c2eb-425e-982b-3e3b42acac90"],
Cell[32497, 707, 443, 9, 68, "Input",ExpressionUUID->"8421e71c-0109-4023-af4c-e53065c1b419",
 InitializationCell->True],
Cell[32943, 718, 604, 15, 46, "Input",ExpressionUUID->"1d9bae5b-05ee-4906-82c2-31058046c09e",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[33584, 738, 182, 3, 37, "Subsubsection",ExpressionUUID->"be6af445-362c-441f-bb99-ca44a1697b44"],
Cell[33769, 743, 915, 15, 152, "Input",ExpressionUUID->"3c11841a-6723-4fae-9b17-cf1dd4bb0771",
 InitializationCell->True],
Cell[34687, 760, 1847, 47, 89, "Input",ExpressionUUID->"eaefa8e7-1597-4255-8961-e04c62426715",
 InitializationCell->True],
Cell[36537, 809, 1124, 30, 89, "Input",ExpressionUUID->"fd936f77-fd81-44b7-bbc3-07bf5db13f5c",
 InitializationCell->True],
Cell[37664, 841, 1847, 47, 89, "Input",ExpressionUUID->"15bd1f97-6319-47a2-a2e1-1eb30cf61e88",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[39548, 893, 207, 4, 37, "Subsubsection",ExpressionUUID->"3e2b861c-c0d2-43a0-a574-dca2cd7083b1"],
Cell[39758, 899, 839, 15, 131, "Input",ExpressionUUID->"0a19520e-826a-40d8-a497-731ac09af72c",
 InitializationCell->True],
Cell[40600, 916, 2570, 67, 140, "Input",ExpressionUUID->"f8786dc2-bd2a-4895-9d16-1424804af910",
 InitializationCell->True],
Cell[43173, 985, 973, 25, 81, "Text",ExpressionUUID->"51db1938-38e7-43be-9f41-9800e53b57ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[44183, 1015, 212, 4, 37, "Subsubsection",ExpressionUUID->"18fd7074-663b-4b53-8ab0-797bcc440cab"],
Cell[44398, 1021, 1531, 25, 173, "Input",ExpressionUUID->"5c1e4655-731c-4274-9157-c56bde48386c",
 InitializationCell->True],
Cell[45932, 1048, 3768, 87, 236, "Input",ExpressionUUID->"1a420612-5cf4-4126-872e-7d9caf1ba513",
 InitializationCell->True],
Cell[49703, 1137, 485, 11, 58, "Text",ExpressionUUID->"2e0b229a-8b2b-41b6-ac8c-0efcb80739a5"],
Cell[CellGroupData[{
Cell[50213, 1152, 791, 21, 30, "Input",ExpressionUUID->"dbd4965f-083f-4da5-a208-9b5d56ea4d7b"],
Cell[51007, 1175, 1350, 38, 56, "Output",ExpressionUUID->"201011ee-3654-4bd7-bc6f-aca4e8a9a96b"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[52406, 1219, 164, 3, 37, "Subsubsection",ExpressionUUID->"345982cf-7a52-487b-bb17-7755b17ffb85"],
Cell[52573, 1224, 429, 10, 35, "Text",ExpressionUUID->"466f92b8-7fdc-4ca2-8d9d-021fc4763f00"],
Cell[53005, 1236, 663, 13, 68, "Input",ExpressionUUID->"7e0b0054-07f8-4887-bdaf-6a8c5fee1661",
 InitializationCell->True],
Cell[53671, 1251, 728, 18, 46, "Input",ExpressionUUID->"0f8dd776-1b4a-4fc9-9b66-791be2b3f27e",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[54436, 1274, 144, 3, 37, "Subsubsection",ExpressionUUID->"f9e51580-308b-4361-a38b-7397a22c91f8"],
Cell[54583, 1279, 815, 14, 152, "Input",ExpressionUUID->"438e530b-05b5-46e4-bbe3-9ae209a00085",
 InitializationCell->True],
Cell[55401, 1295, 3368, 78, 162, "Input",ExpressionUUID->"b2e4b5c0-a279-44f2-8951-ebcdf74b86cc",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[58806, 1378, 168, 3, 37, "Subsubsection",ExpressionUUID->"a1c54c79-375c-4ed6-886e-043ec2b290a0"],
Cell[58977, 1383, 866, 24, 75, "Input",ExpressionUUID->"337e8b4e-09fb-495e-a84a-2f63cbce4495",
 InitializationCell->True],
Cell[59846, 1409, 1441, 36, 165, "Input",ExpressionUUID->"64678083-04e2-4d42-909b-3b2318963177",
 InitializationCell->True],
Cell[61290, 1447, 1177, 26, 54, "Input",ExpressionUUID->"c4ce3183-dba3-4dba-87b5-029159c9a34f",
 InitializationCell->True],
Cell[62470, 1475, 779, 20, 73, "Input",ExpressionUUID->"b6855bba-dd1f-4b75-9715-25b9fcfe3450",
 InitializationCell->True],
Cell[63252, 1497, 11239, 261, 724, "Input",ExpressionUUID->"c1321a98-9f0f-43e6-8272-ce8d8853da73",
 InitializationCell->True],
Cell[74494, 1760, 4393, 105, 299, "Input",ExpressionUUID->"2219d84b-d9d1-4ab5-b857-af6df0b768b9",
 InitializationCell->True],
Cell[78890, 1867, 3671, 88, 236, "Input",ExpressionUUID->"9476a9d6-2a9e-4119-912a-9dc210b03947",
 InitializationCell->True],
Cell[82564, 1957, 3733, 89, 257, "Input",ExpressionUUID->"80f40fa2-bc22-4cb4-aa28-e8f98aa4e390",
 InitializationCell->True],
Cell[86300, 2048, 1560, 35, 173, "Input",ExpressionUUID->"416f1a63-f050-4cac-9b49-7454273f95ca",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[87897, 2088, 189, 3, 37, "Subsubsection",ExpressionUUID->"f5702d31-736f-4b1e-b493-001e0fcc9e27"],
Cell[88089, 2093, 4415, 106, 382, "Input",ExpressionUUID->"ac4b5a23-b945-4dd4-9848-a93fa0fedc6e",
 InitializationCell->True],
Cell[92507, 2201, 983, 24, 131, "Input",ExpressionUUID->"a3280505-36fe-4518-a314-13b03b9acdf1",
 InitializationCell->True],
Cell[93493, 2227, 2745, 62, 257, "Input",ExpressionUUID->"f77a4d16-66ad-4fa3-82c5-90b15261e53f",
 InitializationCell->True],
Cell[96241, 2291, 2236, 49, 194, "Input",ExpressionUUID->"744689c5-dd14-496e-b72e-9f71fe6e1c53",
 InitializationCell->True],
Cell[98480, 2342, 2617, 69, 236, "Input",ExpressionUUID->"1bf9a951-5976-48ad-bae9-b7e87aeb69d9",
 InitializationCell->True],
Cell[101100, 2413, 328, 7, 46, "Input",ExpressionUUID->"62e56fa9-72bb-45df-b755-f8a7db27345c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[101465, 2425, 174, 3, 37, "Subsubsection",ExpressionUUID->"950c66d2-9a4f-444d-9b3d-5189465fd6db"],
Cell[101642, 2430, 1306, 31, 173, "Input",ExpressionUUID->"dbc000ec-25cf-4b5f-8ffd-b7a4275b9994",
 InitializationCell->True],
Cell[102951, 2463, 2436, 53, 215, "Input",ExpressionUUID->"3f269151-0fe3-4260-b615-01890399dbd2",
 InitializationCell->True],
Cell[105390, 2518, 4138, 98, 383, "Input",ExpressionUUID->"7f9f1a47-8c68-462a-b996-f4a95cc63363",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[109565, 2621, 228, 4, 37, "Subsubsection",ExpressionUUID->"52e3b3d9-1a7a-4109-abce-4d09190b54e2"],
Cell[109796, 2627, 1183, 24, 110, "Input",ExpressionUUID->"77e285ed-69c6-42d6-ba59-ee86fe9b173f",
 InitializationCell->True],
Cell[110982, 2653, 2846, 60, 257, "Input",ExpressionUUID->"7d507767-0593-451c-9240-57d3be48e0f8",
 InitializationCell->True],
Cell[113831, 2715, 3441, 75, 236, "Input",ExpressionUUID->"804392bf-53c4-40b4-a2dd-f721d98f5df3",
 InitializationCell->True],
Cell[117275, 2792, 4774, 116, 446, "Input",ExpressionUUID->"9286c4f6-58bc-4cc4-b516-280f60a5cb83",
 InitializationCell->True],
Cell[122052, 2910, 1889, 35, 110, "Input",ExpressionUUID->"663de2c7-8633-472b-83c1-ec37842d2447",
 InitializationCell->True],
Cell[123944, 2947, 708, 21, 52, "Input",ExpressionUUID->"53d89833-0787-4f83-9f75-73325f139768"]
}, Closed]],
Cell[CellGroupData[{
Cell[124689, 2973, 181, 3, 37, "Subsubsection",ExpressionUUID->"c0608fcc-ff32-4577-8ce3-d14c6d54756d"],
Cell[124873, 2978, 2578, 56, 173, "Input",ExpressionUUID->"173c971b-ba7f-4fc5-ad13-962c8bc9ee84",
 InitializationCell->True],
Cell[127454, 3036, 8638, 170, 572, "Input",ExpressionUUID->"31351fd2-5644-463e-a015-c12b0dd00e4c",
 InitializationCell->True],
Cell[136095, 3208, 1302, 27, 110, "Input",ExpressionUUID->"15fe5355-c8d7-437a-a490-de3ede8e3a9a",
 InitializationCell->True],
Cell[137400, 3237, 1197, 27, 110, "Input",ExpressionUUID->"4eb95909-8464-4f55-80a7-3090e31ed172",
 InitializationCell->True],
Cell[138600, 3266, 1335, 27, 110, "Input",ExpressionUUID->"b661a944-23ad-44ed-8f30-30349864b20c",
 InitializationCell->True],
Cell[139938, 3295, 1432, 29, 110, "Input",ExpressionUUID->"39f534a2-ac76-4364-aeb0-bec5f9bff83e",
 InitializationCell->True],
Cell[141373, 3326, 1667, 34, 89, "Input",ExpressionUUID->"1bbeead4-98aa-4264-8fef-9b7bae49a705",
 InitializationCell->True],
Cell[143043, 3362, 407, 10, 62, "Input",ExpressionUUID->"ee6f96c0-9d4f-453b-8df0-0ed7f597cfe8",
 InitializationCell->True],
Cell[143453, 3374, 2087, 46, 152, "Input",ExpressionUUID->"47327a09-dce1-4c0d-aaaf-d286340d71c0",
 InitializationCell->True],
Cell[145543, 3422, 1364, 35, 89, "Input",ExpressionUUID->"42a42ff6-63ad-47d4-b232-42c0efad3158",
 InitializationCell->True],
Cell[146910, 3459, 732, 19, 68, "Input",ExpressionUUID->"007636db-878a-48e2-a450-3e3ab437dea3",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[147679, 3483, 183, 3, 37, "Subsubsection",ExpressionUUID->"ae00f0ba-36ee-4b05-8256-0de337b6f0d1"],
Cell[147865, 3488, 3629, 76, 236, "Input",ExpressionUUID->"7abb1694-ff80-43eb-af98-8d24b42db8a0",
 InitializationCell->True],
Cell[151497, 3566, 477, 12, 46, "Input",ExpressionUUID->"dff60501-09ca-4a12-b9e4-11ded3fde02b",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[152011, 3583, 168, 3, 37, "Subsubsection",ExpressionUUID->"dcdcbc38-d134-49d0-8b02-b752accd2e55"],
Cell[152182, 3588, 4765, 103, 425, "Input",ExpressionUUID->"32aefa05-ef19-4db6-9a7d-3340b5a1f93e",
 InitializationCell->True],
Cell[156950, 3693, 4938, 105, 425, "Input",ExpressionUUID->"7e65f759-25d9-4680-be2a-0021d620e4fc",
 InitializationCell->True],
Cell[161891, 3800, 3381, 83, 215, "Input",ExpressionUUID->"6224da8a-288c-4c56-88b0-fe06c222302c",
 InitializationCell->True],
Cell[165275, 3885, 2478, 55, 215, "Input",ExpressionUUID->"57c91f79-a9a3-4830-9f60-fb114bb341e7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[167790, 3945, 167, 3, 37, "Subsubsection",ExpressionUUID->"41c1f597-5955-41d7-aa71-4b72a2c2e9ff"],
Cell[167960, 3950, 1242, 33, 110, "Input",ExpressionUUID->"6bbcfe22-5e4f-44f6-8be1-a41a794b2e20",
 InitializationCell->True],
Cell[169205, 3985, 1630, 39, 152, "Input",ExpressionUUID->"ff21b21f-f00e-47b4-9533-41756f295ed1"],
Cell[170838, 4026, 893, 22, 131, "Input",ExpressionUUID->"a64d9f9b-5c56-48e0-95a6-2a0b2ba3a322",
 InitializationCell->True],
Cell[171734, 4050, 1352, 32, 152, "Input",ExpressionUUID->"2f7f2ce8-2acd-48c5-869d-88283190d727",
 InitializationCell->True],
Cell[173089, 4084, 1419, 33, 152, "Input",ExpressionUUID->"22e0d828-df15-4e57-88da-3dc1d7fe2f6b",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[174545, 4122, 170, 3, 37, "Subsubsection",ExpressionUUID->"21376b50-8248-4d7a-9f7e-1be4fefff048"],
Cell[174718, 4127, 510, 13, 46, "Input",ExpressionUUID->"5a0cc77a-1529-4e6c-ab46-1c2d71fe8d0a",
 InitializationCell->True],
Cell[175231, 4142, 579, 14, 46, "Input",ExpressionUUID->"9586ab1f-c67d-4a83-877b-b7e55d73f22d",
 InitializationCell->True],
Cell[175813, 4158, 633, 14, 46, "Input",ExpressionUUID->"887a003c-9321-40cb-aa8b-2d2e46292efe",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[176483, 4177, 172, 3, 37, "Subsubsection",ExpressionUUID->"b29fcca5-aa5f-4323-8c44-23977d017a71"],
Cell[176658, 4182, 1963, 45, 215, "Input",ExpressionUUID->"bd9801bf-2808-45a1-a2ec-3c32b2f38df3",
 InitializationCell->True],
Cell[178624, 4229, 1971, 45, 215, "Input",ExpressionUUID->"4a6a672d-8911-43ee-8619-a810232322d8",
 InitializationCell->True],
Cell[180598, 4276, 1574, 39, 110, "Input",ExpressionUUID->"6748f971-35c3-4107-aaf2-a65179a7c4a0",
 InitializationCell->True],
Cell[182175, 4317, 972, 25, 152, "Input",ExpressionUUID->"d24eaa4f-4004-49f9-a054-76db1003593e",
 InitializationCell->True],
Cell[183150, 4344, 922, 24, 152, "Input",ExpressionUUID->"77d4cbd5-7922-48ef-87a1-a7430437cdf1",
 InitializationCell->True]
}, Closed]]
}
]
*)

